<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Censored Data Analysis • NADA2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Censored Data Analysis">
<meta property="og:description" content="NADA2">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NADA2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/DataAnalysis.html">Censored Data Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SwampThingPaul/NADA2/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="DataAnalysis_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Censored Data Analysis</h1>
                        <h4 class="author">Dennis Helsel and Paul Julian</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SwampThingPaul/NADA2/blob/master/vignettes/DataAnalysis.Rmd"><code>vignettes/DataAnalysis.Rmd</code></a></small>
      <div class="hidden name"><code>DataAnalysis.Rmd</code></div>

    </div>

    
    
<div id="start-rstudio" class="section level2">
<h2 class="hasAnchor">
<a href="#start-rstudio" class="anchor"></a>Start RStudio</h2>
<p><em><strong>Caveat:</strong> recently there has been debate on the use and practices surrounding setting a working directory and workflow critiques (see <a href="https://www.tidyverse.org/blog/2017/12/workflow-vs-script/">link</a>). For purposes of this vignette/training, we will use <code><a href="https://rdrr.io/r/base/getwd.html">setwd()</a></code> for simplicity. But honestly, do what works and is comfortable for you. Go forth and code!</em></p>
<div id="set-the-working-directory" class="section level3">
<h3 class="hasAnchor">
<a href="#set-the-working-directory" class="anchor"></a>Set the working directory:</h3>
<p>Set the working directory to one in which you will save any worksheets or output. In RStudio you can easily do this using RStudio’s pull-down menu: <code>Session &gt; Set working directory &gt; Choose directory</code></p>
<p>or</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="st">".../NADA2"</span><span class="op">)</span></code></pre></div>
<p>if you are using <code><a href="https://rdrr.io/r/base/getwd.html">setwd()</a></code>, for reproducibility it is recommend to use the code above.</p>
</div>
<div id="load-packages" class="section level3">
<h3 class="hasAnchor">
<a href="#load-packages" class="anchor"></a>Load Packages</h3>
<p>Load the packages needed. Install 15 packages: You can either do this manually via the packages tab by checking the boxes next to the package names or via console/R-script using <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages(...)</a></code> and <code><a href="https://rdrr.io/r/base/library.html">library(...)</a></code>.</p>
<p><em>Here is a trick to use a list of packages combined with a function that will check if the package is installed, if not install it and then load it.</em></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check.packages</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span><span class="op">{</span>
  <span class="va">new.pkg</span> <span class="op">&lt;-</span> <span class="va">pkg</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">pkg</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="st">"Package"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">new.pkg</span><span class="op">)</span><span class="op">)</span> 
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">new.pkg</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">pkg</span>, <span class="va">require</span>, character.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bestglm"</span>,<span class="st">"car"</span>,<span class="st">"cenGAM"</span>,<span class="st">"EnvStats"</span>,<span class="st">"fitdistrplus"</span>,<span class="st">"Kendall"</span>,
         <span class="st">"mgcv"</span>,<span class="st">"multcomp"</span>,<span class="st">"NADA"</span>,<span class="st">"nlme"</span>,<span class="st">"perm"</span>,<span class="st">"rms"</span>,<span class="st">"survminer"</span>,
         <span class="st">"vegan"</span>,<span class="st">"NADA2"</span>,<span class="st">"bestglm"</span><span class="op">)</span>
<span class="fu">check.packages</span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span></code></pre></div>
<p><em>Loading libraries using console/R-script</em></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load Package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cenGAM</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/alexkowa/EnvStats">EnvStats</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lbbe.univ-lyon1.fr/fitdistrplus.html">fitdistrplus</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.uwo.ca/faculty/aim">Kendall</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://multcomp.R-forge.R-project.org">multcomp</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">NADA</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">perm</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/rms/">rms</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/survminer/index.html">survminer</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vegandevs/vegan">vegan</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/SwampThingPaul/NADA2">NADA2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">bestglm</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/">nlme</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/rms/">rms</a></span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="loading-r-format-databases-from-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-r-format-databases-from-packages" class="anchor"></a>Loading R Format Databases From Packages</h2>
<p>Some packages have datasets contained within them. When you load the packages you have access to those datasets. You can type data() to list all datasets available within the R base packages and in the packages you’ve loaded. Once you know the names of the datasets you want to load, use the data (datasetname) command to load the dataset.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Golden</span><span class="op">)</span>; <span class="co"># From NADA package</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Golden</span>,<span class="fl">5L</span><span class="op">)</span>
<span class="co">#&gt;   Group Dosage DosageGroup      Liver LiverCen       Bone BoneCen     Brain</span>
<span class="co">#&gt; 1     1      0         Low 0.30164120    FALSE 0.19642727   FALSE 0.3462295</span>
<span class="co">#&gt; 2     1      0         Low 0.13614973    FALSE 0.02902514   FALSE 0.3920635</span>
<span class="co">#&gt; 3     1      0         Low 0.04000000     TRUE 0.03000000    TRUE 0.6950323</span>
<span class="co">#&gt; 4     1      0         Low 0.09892787    FALSE 0.03691224   FALSE 0.1906452</span>
<span class="co">#&gt; 5     1      0         Low 0.04000000     TRUE 0.07664027   FALSE 0.0700000</span>
<span class="co">#&gt;   BrainCen Feather FeatherCen Blood BloodCen     Kidney KidneyCen</span>
<span class="co">#&gt; 1    FALSE   0.070       TRUE  0.02     TRUE 0.08196248     FALSE</span>
<span class="co">#&gt; 2    FALSE   0.060       TRUE  0.02     TRUE 0.06293103     FALSE</span>
<span class="co">#&gt; 3    FALSE   0.394      FALSE  0.02     TRUE 0.05865103     FALSE</span>
<span class="co">#&gt; 4    FALSE   0.111      FALSE  0.02     TRUE 0.09555085     FALSE</span>
<span class="co">#&gt; 5     TRUE   0.242      FALSE  0.02     TRUE 0.11623897     FALSE</span></code></pre></div>
</div>
<div id="loading-external-datasets-of-various-formats" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-external-datasets-of-various-formats" class="anchor"></a>Loading External Datasets of Various Formats</h2>
<p>For purposes of this vignette, we won’t be loading external dataset, but here is a description of how to load data of several formats from external files.</p>
<div id="read-in-an-r-format--rda-file-" class="section level3">
<h3 class="hasAnchor">
<a href="#read-in-an-r-format--rda-file-" class="anchor"></a>Read in an R-format (<code>.rda</code>) file.</h3>
<p>In the Environment tab, click the open folder icon. Go to the directory where the data are located and choose the file name.</p>
<p><strong>console/R-script</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">".../path/to/data/data.rda"</span><span class="op">)</span></code></pre></div>
</div>
<div id="read-in-an-excel-format--xlsx-xls-file-" class="section level3">
<h3 class="hasAnchor">
<a href="#read-in-an-excel-format--xlsx-xls-file-" class="anchor"></a>Read in an excel format (<code>.xlsx</code>/<code>.xls</code>) file.</h3>
<p>In the environment tab, click on the Import Data button. Choose the “From Excel” option. Go to the folder where the data file is located and choose the file name. If there are variable names stored as column names, make sure the box next to First Row as Names is checked, and click Import.</p>
<p><strong>console/R-script</strong></p>
<p>There are several R-packages that will read <code>xlsx</code> or <code>xls</code> files into R. Beware some packages have recod limitations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">".../path/to/data/data.xlsx"</span>,sheet<span class="op">=</span><span class="fl">4</span><span class="op">)</span>

<span class="co"># or </span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ycphs.github.io/openxlsx/index.html">openxlsx</a></span><span class="op">)</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">".../path/to/data/data.xlsx"</span>,sheet<span class="op">=</span><span class="fl">4</span><span class="op">)</span></code></pre></div>
</div>
<div id="read-in-an-csv-format--csv-file-" class="section level3">
<h3 class="hasAnchor">
<a href="#read-in-an-csv-format--csv-file-" class="anchor"></a>Read in an csv format (<code>.csv</code>) file.</h3>
<p>In the environment tab, click on the Import Data button. Choose the “From Text (base)…” option. Go to the folder containing the file and choose the file name. Make sure the Heading button YES is selected if the first row in the dataset are the variable names (text). Change the na.strings entry to whatever in the dataset represents a missing value (often a blank in Excel). Click the Import button.</p>
<p><strong>console/R-script</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">".../path/to/data/data.csv"</span><span class="op">)</span></code></pre></div>
</div>
<div id="read-in-an-txt-format--txt-file-" class="section level3">
<h3 class="hasAnchor">
<a href="#read-in-an-txt-format--txt-file-" class="anchor"></a>Read in an txt format (<code>.txt</code>) file.</h3>
<p>In the environment tab, click on the Import Data button. Choose the “From Text (base)…” option. Go to the folder containing the data file and choose the file name. Make sure the Heading button YES is selected if the first row in the dataset are the variable names (text). If necessary, change the na.strings entry to whatever in the dataset represents a missing value (often a blank in Excel). Click the Import button.</p>
<p><strong>console/R-script</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">".../path/to/data/data.txt"</span><span class="op">)</span></code></pre></div>
<p>For other data with specific delimiters (i.e. tab delimited) run <code><a href="https://rdrr.io/r/utils/read.table.html">?read.table</a></code> or <code><a href="https://rdrr.io/r/utils/read.table.html">?read.delim</a></code> for more info.</p>
</div>
</div>
<div id="plotting-censored-data" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-censored-data" class="anchor"></a>Plotting Censored Data</h2>
<div id="boxplots" class="section level3">
<h3 class="hasAnchor">
<a href="#boxplots" class="anchor"></a>Boxplots</h3>
<p><em>Data: Zinc dataset</em></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">CuZn</span><span class="op">)</span>; <span class="co"># Data from the NADA package</span>

<span class="fu"><a href="../reference/cboxplot.html">cboxplot</a></span><span class="op">(</span><span class="va">CuZn</span><span class="op">$</span><span class="va">Zn</span>,<span class="va">CuZn</span><span class="op">$</span><span class="va">ZnCen</span>,<span class="va">CuZn</span><span class="op">$</span><span class="va">Zone</span>,minmax <span class="op">=</span> <span class="cn">TRUE</span>,Xlab<span class="op">=</span><span class="st">"Zone"</span>,Ylab<span class="op">=</span><span class="st">"Zn"</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/bxplot1-1.png" width="624" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="../reference/cboxplot.html">cboxplot</a></span><span class="op">(</span><span class="va">CuZn</span><span class="op">$</span><span class="va">Zn</span>,<span class="va">CuZn</span><span class="op">$</span><span class="va">ZnCen</span>,<span class="va">CuZn</span><span class="op">$</span><span class="va">Zone</span>,LOG<span class="op">=</span><span class="cn">TRUE</span>,Xlab<span class="op">=</span><span class="st">"Zone"</span>,Ylab<span class="op">=</span><span class="st">"Zn"</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/bxplot2-1.png" width="624" style="display: block; margin: auto;"></p>
<p>Note that without the minmax option, outlier observations such as the one in the Alluvial Fan data, are shown individually.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="../reference/cboxplot.html">cboxplot</a></span><span class="op">(</span><span class="va">CuZn</span><span class="op">$</span><span class="va">Zn</span>,<span class="va">CuZn</span><span class="op">$</span><span class="va">ZnCen</span>,<span class="va">CuZn</span><span class="op">$</span><span class="va">Zone</span>,LOG<span class="op">=</span><span class="cn">TRUE</span>,show <span class="op">=</span> <span class="cn">TRUE</span>, minmax <span class="op">=</span> <span class="cn">TRUE</span>,
         Xlab<span class="op">=</span><span class="st">"Zone"</span>,Ylab<span class="op">=</span><span class="st">"Zn"</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/bxplot3-1.png" width="624" style="display: block; margin: auto;"></p>
<p>The show=TRUE option models the portion of each group’s data below the highest detection limit (the lines in gray) using ROS.</p>
</div>
<div id="scatterplots" class="section level3">
<h3 class="hasAnchor">
<a href="#scatterplots" class="anchor"></a>Scatterplots</h3>
<p><em>Data: TCE concentrations in ground water</em></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">TCEReg</span><span class="op">)</span>; <span class="co"># Data from the NADA package</span>

<span class="fu"><a href="https://rdrr.io/pkg/NADA/man/cenxyplot.html">cenxyplot</a></span><span class="op">(</span><span class="va">TCEReg</span><span class="op">$</span><span class="va">PopDensity</span>, <span class="fl">1</span><span class="op">-</span><span class="va">TCEReg</span><span class="op">$</span><span class="va">PopAbv1</span>, <span class="va">TCEReg</span><span class="op">$</span><span class="va">TCEConc</span>, <span class="va">TCEReg</span><span class="op">$</span><span class="va">TCECen</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/scatplot1-1.png" width="624" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/NADA/man/cenxyplot.html">cenxyplot</a></span><span class="op">(</span><span class="va">TCEReg</span><span class="op">$</span><span class="va">PopDensity</span>, <span class="fl">1</span><span class="op">-</span><span class="va">TCEReg</span><span class="op">$</span><span class="va">PopAbv1</span>, <span class="va">TCEReg</span><span class="op">$</span><span class="va">TCEConc</span>, <span class="va">TCEReg</span><span class="op">$</span><span class="va">TCECen</span>,
          xlab<span class="op">=</span><span class="st">"Population Denisty"</span>,ylab<span class="op">=</span><span class="st">"TCE Concentration, in ug/L"</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/scatplot2-1.png" width="624" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/NADA/man/cenxyplot.html">cenxyplot</a></span><span class="op">(</span><span class="va">TCEReg</span><span class="op">$</span><span class="va">PopDensity</span>, <span class="fl">1</span><span class="op">-</span><span class="va">TCEReg</span><span class="op">$</span><span class="va">PopAbv1</span>, <span class="va">TCEReg</span><span class="op">$</span><span class="va">TCEConc</span>, <span class="va">TCEReg</span><span class="op">$</span><span class="va">TCECen</span>,
          xlab<span class="op">=</span><span class="st">"Population Denisty"</span>,ylab<span class="op">=</span><span class="st">"TCE Concentration, in ug/L"</span>, 
          main <span class="op">=</span> <span class="st">"Your Title Here"</span>, log <span class="op">=</span><span class="st">"y"</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/scatplot3-1.png" width="624" style="display: block; margin: auto;"></p>
</div>
<div id="cumulative-distribution-functions-cdfs" class="section level3">
<h3 class="hasAnchor">
<a href="#cumulative-distribution-functions-cdfs" class="anchor"></a>Cumulative distribution functions (CDFs)</h3>
<p><em>Data: Zinc, Pyrene</em></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Data already loaded</span>

<span class="fu"><a href="../reference/cen_ecdf.html">cen_ecdf</a></span><span class="op">(</span><span class="va">CuZn</span><span class="op">$</span><span class="va">Zn</span>, <span class="va">CuZn</span><span class="op">$</span><span class="va">ZnCen</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/cdf1-1.png" width="624" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/cen_ecdf.html">cen_ecdf</a></span><span class="op">(</span><span class="va">CuZn</span><span class="op">$</span><span class="va">Zn</span>, <span class="va">CuZn</span><span class="op">$</span><span class="va">ZnCen</span>,<span class="va">CuZn</span><span class="op">$</span><span class="va">Zone</span>,
         Ylab<span class="op">=</span><span class="st">"Zinc Concentration, in ug/L"</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/cdf2-1.png" width="624" style="display: block; margin: auto;"></p>
<div id="compare-cdfs" class="section level4">
<h4 class="hasAnchor">
<a href="#compare-cdfs" class="anchor"></a>Compare CDFs</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">ShePyrene</span><span class="op">)</span>; <span class="co"># From the NADA package</span>

<span class="fu"><a href="../reference/cenCompareCdfs.html">cenCompareCdfs</a></span><span class="op">(</span><span class="va">ShePyrene</span><span class="op">$</span><span class="va">Pyrene</span>,<span class="va">ShePyrene</span><span class="op">$</span><span class="va">PyreneCen</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/cdf%20comp1-1.png" width="624" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/cenCompareCdfs.html">cenCompareCdfs</a></span><span class="op">(</span><span class="va">ShePyrene</span><span class="op">$</span><span class="va">Pyrene</span>,<span class="va">ShePyrene</span><span class="op">$</span><span class="va">PyreneCen</span>,dist3 <span class="op">=</span> <span class="st">"weibull"</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/cdf%20comp2-1.png" width="624" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="probability-q-q-plots-pyrene-data" class="section level3">
<h3 class="hasAnchor">
<a href="#probability-q-q-plots-pyrene-data" class="anchor"></a>Probability (Q-Q) Plots: Pyrene data</h3>
<p><em>Data: Pyrene</em></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/cenQQ.html">cenQQ</a></span><span class="op">(</span><span class="va">ShePyrene</span><span class="op">$</span><span class="va">Pyrene</span>,<span class="va">ShePyrene</span><span class="op">$</span><span class="va">PyreneCen</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/QQ1-1.png" width="624" style="display: block; margin: auto;"></p>
<div id="compare-qqs" class="section level4">
<h4 class="hasAnchor">
<a href="#compare-qqs" class="anchor"></a>Compare QQs</h4>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/cenCompareQQ.html">cenCompareQQ</a></span><span class="op">(</span><span class="va">ShePyrene</span><span class="op">$</span><span class="va">Pyrene</span>,<span class="va">ShePyrene</span><span class="op">$</span><span class="va">PyreneCen</span>,Yname<span class="op">=</span><span class="st">"Pyrene"</span>,cex<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span>
<span class="co">#&gt; Best of the three distributions is the lognormal</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/QQ2-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div id="estimate-descriptive-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#estimate-descriptive-statistics" class="anchor"></a>Estimate Descriptive Statistics</h2>
<div id="exploring-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#exploring-the-data" class="anchor"></a>Exploring the data</h3>
<p>In R, the summary command is used to briefly describe the characteristics of the data. In the NADA for R package, the censummary command fulfills the same role for censored data:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/NADA/man/censummary.html">censummary</a></span><span class="op">(</span><span class="va">ShePyrene</span><span class="op">$</span><span class="va">Pyrene</span>,<span class="va">ShePyrene</span><span class="op">$</span><span class="va">PyreneCen</span><span class="op">)</span>
<span class="co">#&gt; all:</span>
<span class="co">#&gt;          n      n.cen    pct.cen        min        max </span>
<span class="co">#&gt;   56.00000   11.00000   19.64286   28.00000 2982.00000 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; limits:</span>
<span class="co">#&gt;   limit n uncen   pexceed</span>
<span class="co">#&gt; 1    28 1     3 0.9636368</span>
<span class="co">#&gt; 2    35 2     3 0.8545470</span>
<span class="co">#&gt; 3    58 1    10 0.7818206</span>
<span class="co">#&gt; 4    86 1    11 0.5636411</span>
<span class="co">#&gt; 5   117 1     2 0.3350722</span>
<span class="co">#&gt; 6   122 1     5 0.2947735</span>
<span class="co">#&gt; 7   163 3     1 0.1968254</span>
<span class="co">#&gt; 8   174 1    10 0.1785714</span></code></pre></div>
<p>There are 11 nondetects located at 8 different detection limits. The probabilities of being less than or equal to the detection limit value is (1-pexceed), one minus the exceedance probability. So the limit at a concentration of 28 is at the (1-0.964), or the 3.6th percentile of the data. And (1-0.179) or 82.1% of the observations are below the highest detection limit of 174.</p>
<p>I’ll demonstrate how to compute MLE, K-M and ROS statistics using both the NADA and EnvStats packages.</p>
</div>
<div id="maximum-likelihood-estimation-mle" class="section level3">
<h3 class="hasAnchor">
<a href="#maximum-likelihood-estimation-mle" class="anchor"></a>Maximum Likelihood Estimation (MLE)</h3>
<p>The cenmle command in the NADA package assumes by default that data follow a <em>lognormal</em> distribution. Other distributions may be specified as options. We will use the <em>lognormal</em> because it was the best-fitting distribution, as seen in the Plotting Data exercise. The results have been stored as an object <code>(Pyr.mle.nada</code>, below) and by typing the object name you get the output.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pyr.mle.nada</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,
                     <span class="fu"><a href="https://rdrr.io/pkg/NADA/man/cenmle.html">cenmle</a></span><span class="op">(</span><span class="va">Pyrene</span>,<span class="va">PyreneCen</span><span class="op">)</span><span class="op">)</span>
<span class="va">Pyr.mle.nada</span>
<span class="co">#&gt;         n     n.cen    median      mean        sd </span>
<span class="co">#&gt;  56.00000  11.00000  91.64813 133.91419 142.66984</span></code></pre></div>
<p>The EnvStats package provides different commands for each distribution chosen. As with the plots, <em>“lnorm”</em> indicates a <em>lognormal</em> distribution, “norm” a normal distribution, and “gamma” a gamma distribution. These come after the <em>“e”</em> in the command name. The <em>“Alt”</em> in the command tells <code>EnvStats</code> to report back the <em>lognormal</em> results not in log units, but transformed back into original units. The output is much more detailed than in the <code>NADA</code> package. In this example, options for computing two-sided confidence intervals of the mean are specified, which we’ll discuss in the next section of the vignette.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pyr.mle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,
                <span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/elnormAltCensored.html">elnormAltCensored</a></span><span class="op">(</span><span class="va">Pyrene</span>, <span class="va">PyreneCen</span>, 
                             ci<span class="op">=</span><span class="cn">TRUE</span>, ci.method <span class="op">=</span><span class="st">"bootstrap"</span>,
                             n.bootstraps <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span><span class="op">)</span>
<span class="fu">EnvStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/print.html">print</a></span><span class="op">(</span><span class="va">Pyr.mle</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results of Distribution Parameter Estimation</span>
<span class="co">#&gt; Based on Type I Censored Data</span>
<span class="co">#&gt; --------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Distribution:            Lognormal</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Side:                  left</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Level(s):               28  35  58  86 117 122 163 174 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated Parameter(s):          mean = 133.914189</span>
<span class="co">#&gt;                                  cv   =   1.065383</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimation Method:               MLE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data:                            Pyrene</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Variable:              PyreneCen</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Size:                     56</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Percent Censored:                19.64286%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval for:         mean</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Method:      Bootstrap</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstraps:            5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstrap Samples</span>
<span class="co">#&gt; With No Censored Values:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Times Bootstrap</span>
<span class="co">#&gt; Repeated Because Too Few</span>
<span class="co">#&gt; Uncensored Observations:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Type:        two-sided</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Level:                95%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval:             Pct.LCL = 100.34020</span>
<span class="co">#&gt;                                  Pct.UCL = 190.03853</span>
<span class="co">#&gt;                                  BCa.LCL =  99.35878</span>
<span class="co">#&gt;                                  BCa.UCL = 186.36085</span></code></pre></div>
<p>Using the print statement after storing the output in an object (<code>Pyr.mle</code> was used here) produces the table type output shown above. Without the print statement, just typing the object name, the output is generic and not ready to be pasted into a results document.</p>
</div>
<div id="kaplan-meier" class="section level3">
<h3 class="hasAnchor">
<a href="#kaplan-meier" class="anchor"></a>Kaplan-Meier</h3>
<p>The cenfit function in the <code>NADA</code> package has a slightly incorrect detail in its computation of the mean. Here it is, but remember that this issue generally makes the computed mean slightly too high.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pyr.km.nada</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,
                    <span class="fu"><a href="https://rdrr.io/pkg/NADA/man/cenfit.html">cenfit</a></span><span class="op">(</span><span class="va">Pyrene</span>, <span class="va">PyreneCen</span><span class="op">)</span><span class="op">)</span>
<span class="va">Pyr.km.nada</span>
<span class="co">#&gt;        n    n.cen   median     mean       sd </span>
<span class="co">#&gt;  56.0000  11.0000  98.0000 164.2036 393.9509</span></code></pre></div>
<p>You should use the <code>EnvStats</code> command <code>enparCensored</code> instead for Kaplan-Meier, until this issue in the <code>NADA</code> package is corrected. The <code>EnvStats</code> command uses “npar” for nonparametric to produce the Kaplan-Meier estimates.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pyr.km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,
                <span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/enparCensored.html">enparCensored</a></span><span class="op">(</span><span class="va">Pyrene</span>, <span class="va">PyreneCen</span>, 
                             ci<span class="op">=</span><span class="cn">TRUE</span>, ci.method <span class="op">=</span><span class="st">"bootstrap"</span>,
                             n.bootstraps <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span><span class="op">)</span>
<span class="fu">EnvStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/print.html">print</a></span><span class="op">(</span><span class="va">Pyr.km</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results of Distribution Parameter Estimation</span>
<span class="co">#&gt; Based on Type I Censored Data</span>
<span class="co">#&gt; --------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Distribution:            None</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Side:                  left</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Level(s):               28  35  58  86 117 122 163 174 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated Parameter(s):          mean    = 164.09450</span>
<span class="co">#&gt;                                  sd      = 389.41379</span>
<span class="co">#&gt;                                  se.mean =  49.75292</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimation Method:               Kaplan-Meier</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data:                            Pyrene</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Variable:              PyreneCen</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Size:                     56</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Percent Censored:                19.64286%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval for:         mean</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Sample Size:             56</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Method:      Bootstrap</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstraps:            5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstrap Samples</span>
<span class="co">#&gt; With No Censored Values:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Times Bootstrap</span>
<span class="co">#&gt; Repeated Because Too Few</span>
<span class="co">#&gt; Uncensored Observations:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Type:        two-sided</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Level:                95%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval:             Pct.LCL =  99.61746</span>
<span class="co">#&gt;                                  Pct.UCL = 264.85788</span>
<span class="co">#&gt;                                  BCa.LCL =  98.19357</span>
<span class="co">#&gt;                                  BCa.UCL = 262.17446</span>
<span class="co">#&gt;                                  t.LCL   = 102.31721</span>
<span class="co">#&gt;                                  t.UCL   = 616.56594</span></code></pre></div>
<p>Note that as with all bootstrap estimates the confidence intervals above will differ slightly from your results.</p>
</div>
<div id="regression-on-order-statistics-ros" class="section level3">
<h3 class="hasAnchor">
<a href="#regression-on-order-statistics-ros" class="anchor"></a>Regression on Order Statistics (ROS)</h3>
<p>The <code>cenros</code> command in the <code>NADA</code> package constructs ROS models. The default model fits the data to a <em>lognormal</em> distribution. A Q-Q plot is drawn by the plot command using the ROS model. The cenros function will not take data with embedded NA values – manually delete them first or use the <code>elnormAltCensored</code> function as in the next section.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pyr.ROS.nada</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,
                     <span class="fu"><a href="https://rdrr.io/pkg/NADA/man/ros.html">cenros</a></span><span class="op">(</span><span class="va">Pyrene</span>, <span class="va">PyreneCen</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Pyr.ROS.nada</span><span class="op">)</span>
<span class="co">#&gt; [1] 163.2494</span>

<span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">Pyr.ROS.nada</span><span class="op">)</span>
<span class="co">#&gt; [1] 393.1068</span>

<span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">Pyr.ROS.nada</span><span class="op">)</span>
<span class="co">#&gt;        5%       10%       25%       50%       75%       90%       95% </span>
<span class="co">#&gt;  30.78771  33.00000  63.45761  90.50000 132.25000 255.50000 312.75000</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Pyr.ROS.nada</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DataAnalysis_files/figure-html/unnamed-chunk-12-1.png" alt="Lognormal probability of pyrene data" width="624"><p class="caption">
Lognormal probability of pyrene data
</p>
</div>
<p>The <code>EnvStats</code> command is again <code>elnormAltCensored</code>, but here with the “rROS” option to compute ROS. In that case the <em>lognormal</em> assumption is only for the nondetect data. It also produces confidence intervals for the ROS mean by bootstrapping, making it very useful.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pyr.ROS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,
                <span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/elnormAltCensored.html">elnormAltCensored</a></span><span class="op">(</span><span class="va">Pyrene</span>, <span class="va">PyreneCen</span>, method<span class="op">=</span><span class="st">"rROS"</span>,
                             ci<span class="op">=</span><span class="cn">TRUE</span>, ci.method <span class="op">=</span><span class="st">"bootstrap"</span>,
                             n.bootstraps <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span><span class="op">)</span>

<span class="fu">EnvStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/print.html">print</a></span><span class="op">(</span><span class="va">Pyr.ROS</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results of Distribution Parameter Estimation</span>
<span class="co">#&gt; Based on Type I Censored Data</span>
<span class="co">#&gt; --------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Distribution:            Lognormal</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Side:                  left</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Level(s):               28  35  58  86 117 122 163 174 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated Parameter(s):          mean = 163.371129</span>
<span class="co">#&gt;                                  cv   =   2.406266</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimation Method:               Imputation with                                 Q-Q Regression (rROS)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data:                            Pyrene</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Variable:              PyreneCen</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Size:                     56</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Percent Censored:                19.64286%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval for:         mean</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Method:      Bootstrap</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstraps:            5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstrap Samples</span>
<span class="co">#&gt; With No Censored Values:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Times Bootstrap</span>
<span class="co">#&gt; Repeated Because Too Few</span>
<span class="co">#&gt; Uncensored Observations:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Type:        two-sided</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Level:                95%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval:             Pct.LCL = 100.83282</span>
<span class="co">#&gt;                                  Pct.UCL = 264.96703</span>
<span class="co">#&gt;                                  BCa.LCL =  98.12926</span>
<span class="co">#&gt;                                  BCa.UCL = 257.43595</span></code></pre></div>
</div>
<div id="all-at-once" class="section level3">
<h3 class="hasAnchor">
<a href="#all-at-once" class="anchor"></a>All at once</h3>
<p>Descriptive stats for all three methods, again for the default lognormal distribution, can quickly be produced using the censtats command of the NADA package: Unfortunately this <code>NADA</code> package command also cannot currently incorporate <code>NA</code> values, so remove them prior to running the command.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,<span class="fu"><a href="https://rdrr.io/pkg/NADA/man/censtats.html">censtats</a></span><span class="op">(</span><span class="va">Pyrene</span>, <span class="va">PyreneCen</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;        n    n.cen  pct.cen </span>
<span class="co">#&gt; 56.00000 11.00000 19.64286</span>
<span class="co">#&gt;       median     mean       sd</span>
<span class="co">#&gt; K-M 98.00000 164.2036 393.9509</span>
<span class="co">#&gt; ROS 90.50000 163.2494 393.1068</span>
<span class="co">#&gt; MLE 91.64813 133.9142 142.6698</span></code></pre></div>
<p>K-M and ROS use the high outlier data value to estimate the mean. MLE uses the lognormal model, whose value at that percentile is lower and therefore the MLE estimate of the mean for this dataset is lower. And again, the K-M mean computed in this <code>NADA</code> package function is slightly biased high.</p>
</div>
</div>
<div id="interval-estimates" class="section level2">
<h2 class="hasAnchor">
<a href="#interval-estimates" class="anchor"></a>Interval Estimates</h2>
<p>Several of the commands to obtain confidence intervals are identical to what we was done in the Estimating Descriptive Statistics section Prediction. and tolerance intervals are new.</p>
<div id="confidene-intervals" class="section level3">
<h3 class="hasAnchor">
<a href="#confidene-intervals" class="anchor"></a>Confidene Intervals</h3>
<div id="kaplan-meier-1" class="section level4">
<h4 class="hasAnchor">
<a href="#kaplan-meier-1" class="anchor"></a>Kaplan-Meier</h4>
<p>A confidence interval around the KM mean is computed using the enparCensored command. Since K-M is a nonparametric method, the bootstrap method for computing a CI is recommended, as it too requires no assumed distribution. Note that the default CI method is a t-interval, which requires that the distribution of possible estimates of the mean is a normal distribution in order for this confidence interval to be valid. When the sample size is around 70+ this may be a reasonable assumption. For this example it is not. Bootstrap intervals work fine with large and smaller data, say 20 observations and above. First the bootstrap:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## from above</span>
<span class="fu">EnvStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/print.html">print</a></span><span class="op">(</span><span class="va">Pyr.km</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results of Distribution Parameter Estimation</span>
<span class="co">#&gt; Based on Type I Censored Data</span>
<span class="co">#&gt; --------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Distribution:            None</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Side:                  left</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Level(s):               28  35  58  86 117 122 163 174 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated Parameter(s):          mean    = 164.09450</span>
<span class="co">#&gt;                                  sd      = 389.41379</span>
<span class="co">#&gt;                                  se.mean =  49.75292</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimation Method:               Kaplan-Meier</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data:                            Pyrene</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Variable:              PyreneCen</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Size:                     56</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Percent Censored:                19.64286%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval for:         mean</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Sample Size:             56</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Method:      Bootstrap</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstraps:            5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstrap Samples</span>
<span class="co">#&gt; With No Censored Values:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Times Bootstrap</span>
<span class="co">#&gt; Repeated Because Too Few</span>
<span class="co">#&gt; Uncensored Observations:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Type:        two-sided</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Level:                95%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval:             Pct.LCL =  99.61746</span>
<span class="co">#&gt;                                  Pct.UCL = 264.85788</span>
<span class="co">#&gt;                                  BCa.LCL =  98.19357</span>
<span class="co">#&gt;                                  BCa.UCL = 262.17446</span>
<span class="co">#&gt;                                  t.LCL   = 102.31721</span>
<span class="co">#&gt;                                  t.UCL   = 616.56594</span></code></pre></div>
<p>Then the default normal assumption (basically, a t-interval using the K-M estimates of mean and standard deviation):</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pyr.km2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,<span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/enparCensored.html">enparCensored</a></span><span class="op">(</span><span class="va">Pyrene</span>,<span class="va">PyreneCen</span>, ci<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="fu">EnvStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/print.html">print</a></span><span class="op">(</span><span class="va">Pyr.km2</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results of Distribution Parameter Estimation</span>
<span class="co">#&gt; Based on Type I Censored Data</span>
<span class="co">#&gt; --------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Distribution:            None</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Side:                  left</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Level(s):               28  35  58  86 117 122 163 174 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated Parameter(s):          mean    = 164.09450</span>
<span class="co">#&gt;                                  sd      = 389.41379</span>
<span class="co">#&gt;                                  se.mean =  49.75292</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimation Method:               Kaplan-Meier</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data:                            Pyrene</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Variable:              PyreneCen</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Size:                     56</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Percent Censored:                19.64286%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval for:         mean</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Method:      Normal Approximation</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Type:        two-sided</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Level:                95%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval:             LCL =  66.58057</span>
<span class="co">#&gt;                                  UCL = 261.60844</span></code></pre></div>
<p>This t-interval (Normal Approximation) LCL goes down considerably lower (66.5) than the BCa bootstrap interval (98.3) because the t-interval must be symmetric, and the upper end is approx. 100 ug/L above the mean, so the LCL must be 100 below the mean. The data don’t warrant that low of an interval as they are asymmetric, and the bootstrap LCL picks up on that information.</p>
</div>
<div id="mle" class="section level4">
<h4 class="hasAnchor">
<a href="#mle" class="anchor"></a>MLE</h4>
<p>Computing the mean of an cenmle object also gives its confidence interval:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pymle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,<span class="fu"><a href="https://rdrr.io/pkg/NADA/man/cenmle.html">cenmle</a></span><span class="op">(</span><span class="va">Pyrene</span>, <span class="va">PyreneCen</span>,conf.int<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pymle</span><span class="op">)</span>
<span class="co">#&gt;      mean        se   0.95LCL   0.95UCL </span>
<span class="co">#&gt; 133.91419  19.06506 102.51010 174.93895</span></code></pre></div>
<p>These assume the default <em>lognormal</em> distribution. Change the <code>conf.int=</code> value to get an interval with something other than the default 0.95 confidence coefficient. To get the more typical normal distribution interval, use the <code>dist="gaussian"</code> option.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pymlenorm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,<span class="fu"><a href="https://rdrr.io/pkg/NADA/man/cenmle.html">cenmle</a></span><span class="op">(</span><span class="va">Pyrene</span>, <span class="va">PyreneCen</span>, dist<span class="op">=</span><span class="st">"gaussian"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pymlenorm</span><span class="op">)</span>
<span class="co">#&gt;      mean        se   0.95LCL   0.95UCL </span>
<span class="co">#&gt; 163.09649  52.14325  60.89759 265.29538</span></code></pre></div>
<p>A better method for computing confidence intervals and bounds for skewed data would be bootstrapping. This is the option we used in the Descriptive Statistics exercise above. For the <em>lognormal</em> MLE method:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pyr.lnorm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,
                  <span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/elnormAltCensored.html">elnormAltCensored</a></span><span class="op">(</span><span class="va">Pyrene</span>, <span class="va">PyreneCen</span>, 
                                    ci<span class="op">=</span><span class="cn">TRUE</span>, ci.method <span class="op">=</span><span class="st">"bootstrap"</span>, 
                                    n.bootstraps <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span><span class="op">)</span>

<span class="fu">EnvStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/print.html">print</a></span><span class="op">(</span><span class="va">pyr.lnorm</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results of Distribution Parameter Estimation</span>
<span class="co">#&gt; Based on Type I Censored Data</span>
<span class="co">#&gt; --------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Distribution:            Lognormal</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Side:                  left</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Level(s):               28  35  58  86 117 122 163 174 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated Parameter(s):          mean = 133.914189</span>
<span class="co">#&gt;                                  cv   =   1.065383</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimation Method:               MLE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data:                            Pyrene</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Variable:              PyreneCen</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Size:                     56</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Percent Censored:                19.64286%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval for:         mean</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Method:      Bootstrap</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstraps:            5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstrap Samples</span>
<span class="co">#&gt; With No Censored Values:         1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Times Bootstrap</span>
<span class="co">#&gt; Repeated Because Too Few</span>
<span class="co">#&gt; Uncensored Observations:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Type:        two-sided</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Level:                95%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval:             Pct.LCL =  99.40216</span>
<span class="co">#&gt;                                  Pct.UCL = 189.93953</span>
<span class="co">#&gt;                                  BCa.LCL =  98.45858</span>
<span class="co">#&gt;                                  BCa.UCL = 187.12643</span></code></pre></div>
</div>
<div id="ros" class="section level4">
<h4 class="hasAnchor">
<a href="#ros" class="anchor"></a>ROS</h4>
<p>The <code>cenros</code> command in <code>NADA</code> does not compute confidence intervals for the mean. Use the <code>EnvStats</code> command <code>elnormAltCensored</code> as done previously in the Descriptive Statistics exercise to bootstrap a confidence interval for the ROS method.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># from above</span>
<span class="fu">EnvStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/print.html">print</a></span><span class="op">(</span><span class="va">Pyr.ROS</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results of Distribution Parameter Estimation</span>
<span class="co">#&gt; Based on Type I Censored Data</span>
<span class="co">#&gt; --------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Distribution:            Lognormal</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Side:                  left</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Level(s):               28  35  58  86 117 122 163 174 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated Parameter(s):          mean = 163.371129</span>
<span class="co">#&gt;                                  cv   =   2.406266</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimation Method:               Imputation with                                 Q-Q Regression (rROS)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data:                            Pyrene</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Variable:              PyreneCen</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Size:                     56</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Percent Censored:                19.64286%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval for:         mean</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Method:      Bootstrap</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstraps:            5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstrap Samples</span>
<span class="co">#&gt; With No Censored Values:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Times Bootstrap</span>
<span class="co">#&gt; Repeated Because Too Few</span>
<span class="co">#&gt; Uncensored Observations:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Type:        two-sided</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Level:                95%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval:             Pct.LCL = 100.83282</span>
<span class="co">#&gt;                                  Pct.UCL = 264.96703</span>
<span class="co">#&gt;                                  BCa.LCL =  98.12926</span>
<span class="co">#&gt;                                  BCa.UCL = 257.43595</span></code></pre></div>
<p>Generally, I recommend using a bootstrap estimate when there is sufficient data, which there are here, as theoretical methods such as Cox are strongly dependent on the <em>lognormal</em> shape that often does not fit exactly. Remember, ROS assumes a distribution but only for the censored observations.</p>
</div>
</div>
<div id="prediction-intervals" class="section level3">
<h3 class="hasAnchor">
<a href="#prediction-intervals" class="anchor"></a>Prediction Intervals</h3>
<p>Intervals for computing the range of probable values for new observations when the data distribution has not changed can be quickly performed using MLE for three assumed distributions using the cenPredInt command:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,<span class="fu"><a href="../reference/cenPredInt.html">cenPredInt</a></span><span class="op">(</span><span class="va">Pyrene</span>, <span class="va">PyreneCen</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; 95% Prediction Limits</span>
<span class="co">#&gt;   Distribution      95% LPL  95% UPL</span>
<span class="co">#&gt; 1    Lognormal   15.7540607 533.1565</span>
<span class="co">#&gt; 2        Gamma    0.7231388 581.0615</span>
<span class="co">#&gt; 3       Normal -783.7555461 992.1820</span></code></pre></div>
<p>The default intervals here are for 1 new observation. That can be changed with the <code>newobs =</code>option. See NADA2 package. You can ignore the warnings about NAs in the dataset, they are deleted prior to computing the intervals, just as you would by hand if necessary.</p>
<p>The same function can be used to compute PIs using ROS, here for 2 new observations, which will make them wider than the intervals for 1 new observation above:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,<span class="fu"><a href="../reference/cenPredInt.html">cenPredInt</a></span><span class="op">(</span><span class="va">Pyrene</span>, <span class="va">PyreneCen</span>,newobs <span class="op">=</span><span class="fl">2</span>, method <span class="op">=</span> <span class="st">"rROS"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; 95% Prediction Limits</span>
<span class="co">#&gt;   Distribution      95% LPL   95% UPL</span>
<span class="co">#&gt; 1    Lognormal   13.0468382  667.8651</span>
<span class="co">#&gt; 2        Gamma    0.1274249  692.7938</span>
<span class="co">#&gt; 3       Normal -817.2081679 1093.6174</span></code></pre></div>
<p>The normal distribution is this example is not a good fit, as shown by the negative value of the lower 95% prediction intervals when assuming a normal distribution.</p>
</div>
<div id="tolerance-intervals" class="section level3">
<h3 class="hasAnchor">
<a href="#tolerance-intervals" class="anchor"></a>Tolerance Intervals</h3>
<p>Intervals for computing an upper bound on the true X% percentile, to state that we are 95% confident that no more than (1-X%) of data will exceed it, are computed using MLE by:</p>
<p>(Here for the 90th percentile – no more than 10% exceedances).</p>
<p>To compute a tolerance interval for three distributions, plus a graph showing BIC stats to determine which is best (lowest BIC is best), use the <code>cenTolInt</code> function in the <code>NADA2</code> package:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,<span class="fu"><a href="../reference/cenTolInt.html">cenTolInt</a></span><span class="op">(</span><span class="va">Pyrene</span>, <span class="va">PyreneCen</span>, cover<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-23-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;   Distribution 90th Pctl  95% UTL      BIC Method
#&gt; 1    Lognormal  279.7995 376.4538 563.1224    mle
#&gt; 2        Gamma  340.2525 440.4870 591.4928    mle
#&gt; 3       Normal  667.0507 816.6821 737.2320    mle</code></pre>
<p>What’s inside this function? If you would like info on the commands this function uses, its below. If that’s not your thing, just use the function! Here’s how you would get the lognormal tolerance interval:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ShePyrene</span>,
            <span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/eqlnormCensored.html">eqlnormCensored</a></span> <span class="op">(</span><span class="va">Pyrene</span>, <span class="va">PyreneCen</span>, p<span class="op">=</span><span class="fl">0.9</span>, 
                             ci<span class="op">=</span><span class="cn">TRUE</span>, ci.type <span class="op">=</span><span class="st">"upper"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">EnvStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/print.html">print</a></span><span class="op">(</span><span class="va">example</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results of Distribution Parameter Estimation</span>
<span class="co">#&gt; Based on Type I Censored Data</span>
<span class="co">#&gt; --------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Distribution:            Lognormal</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Side:                  left</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Level(s):               28  35  58  86 117 122 163 174 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated Parameter(s):          meanlog = 4.5179565</span>
<span class="co">#&gt;                                  sdlog   = 0.8709106</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimation Method:               MLE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated Quantile(s):           90'th %ile = 279.7995</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Quantile Estimation Method:      Quantile(s) Based on</span>
<span class="co">#&gt;                                  MLE Estimators</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data:                            Pyrene</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Variable:              PyreneCen</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Size:                     56</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Percent Censored:                19.64286%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval for:         90'th %ile</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Sample Size:             56</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Method:      Exact for</span>
<span class="co">#&gt;                                  Complete Data</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Type:        upper</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Level:                95%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval:             LCL =   0.0000</span>
<span class="co">#&gt;                                  UCL = 376.4538</span></code></pre></div>
<p>Here’s how you would compute a gamma tolerance interval by first taking cube roots, then using those in a censored normal routine to get a tolerance interval on a percentile, then retransforming back to the original data scale by cubing the result:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">dat.gamma</span> <span class="op">&lt;-</span> <span class="va">ShePyrene</span><span class="op">$</span><span class="va">Pyrene</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>

<span class="va">obj.gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/eqnormCensored.html">eqnormCensored</a></span><span class="op">(</span><span class="va">dat.gamma</span>, <span class="va">ShePyrene</span><span class="op">$</span><span class="va">PyreneCen</span>, p<span class="op">=</span><span class="fl">0.9</span>, 
                            ci<span class="op">=</span><span class="cn">TRUE</span>, ci.type <span class="op">=</span><span class="st">"upper"</span><span class="op">)</span>
<span class="va">pct.gamma</span> <span class="op">&lt;-</span> <span class="va">obj.gamma</span><span class="op">$</span><span class="va">quantiles</span><span class="op">^</span><span class="fl">3</span> <span class="co"># the 90th percentile in orig units</span>
<span class="va">pct.gamma</span>
<span class="co">#&gt; 90'th %ile </span>
<span class="co">#&gt;   340.2525</span>

<span class="va">ti.gamma</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">obj.gamma</span><span class="op">$</span><span class="va">interval</span><span class="op">$</span><span class="va">limits</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span> <span class="co"># the upper tol limit in orig units</span>
<span class="va">ti.gamma</span>
<span class="co">#&gt;     UCL </span>
<span class="co">#&gt; 440.487</span></code></pre></div>
<p>This agrees with the output of the <code>cenTolInt</code> command used above, where the results for a gamma distribution are printed.</p>
</div>
</div>
<div id="matched-pair-tests-and-comparing-data-to-standards" class="section level2">
<h2 class="hasAnchor">
<a href="#matched-pair-tests-and-comparing-data-to-standards" class="anchor"></a>Matched Pair Tests and Comparing Data to Standards</h2>
<div id="compare-data-to-a-standard-using-a-matched-pair-test" class="section level3">
<h3 class="hasAnchor">
<a href="#compare-data-to-a-standard-using-a-matched-pair-test" class="anchor"></a>Compare Data to a Standard Using a Matched Pair Test</h3>
<p><strong>Example 1:</strong> Use the <code>cen_paired</code> function to determine if arsenic concentrations in groundwater exceed the drinking water standard of 10 ug/L standard for the Example1 dataset.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Example1</span><span class="op">)</span> <span class="co"># From NADA2 package</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Example1</span>,<span class="fl">5L</span><span class="op">)</span>
<span class="co">#&gt;   Arsenic NDis1 NDisTRUE</span>
<span class="co">#&gt; 1 4.00000     1     TRUE</span>
<span class="co">#&gt; 2 4.20000     0    FALSE</span>
<span class="co">#&gt; 3 0.61606     0    FALSE</span>
<span class="co">#&gt; 4 5.27628     0    FALSE</span>
<span class="co">#&gt; 5 3.00000     1     TRUE</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Example1</span>,<span class="fu"><a href="../reference/cen_paired.html">cen_paired</a></span><span class="op">(</span><span class="va">Arsenic</span>, <span class="va">NDisTRUE</span>, <span class="fl">10</span>, alt <span class="op">=</span> <span class="st">"greater"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;  Censored paired test for mean(Arsenic) equals 10 </span>
<span class="co">#&gt;  alternative hypothesis: true mean Arsenic exceeds 10. </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  n = 21   Z= -20.4157   p-value = 1 </span>
<span class="co">#&gt;  Mean Arsenic = 2.252</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-26-1.png" width="624" style="display: block; margin: auto;"></p>
<p>The mean arsenic concentration does not exceed 10 ug/L.</p>
</div>
<div id="test-for-differences-in-two-paired-columns-of-data" class="section level3">
<h3 class="hasAnchor">
<a href="#test-for-differences-in-two-paired-columns-of-data" class="anchor"></a>Test for Differences in Two Paired Columns of Data</h3>
<p><strong>Example 2:</strong> Test whether atrazine concentrations were the same in June versus September groundwaters on the same dates in a variety of wells (rows – paired data). Test both for differences in the mean as well as differences in the cdfs and the medians.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Atra</span><span class="op">)</span>; <span class="co"># From NADA package</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Atra</span>,<span class="fl">5L</span><span class="op">)</span>
<span class="co">#&gt;   June Sept JuneCen SeptCen</span>
<span class="co">#&gt; 1 0.38 2.66   FALSE   FALSE</span>
<span class="co">#&gt; 2 0.04 0.63   FALSE   FALSE</span>
<span class="co">#&gt; 3 0.01 0.59    TRUE   FALSE</span>
<span class="co">#&gt; 4 0.03 0.05   FALSE   FALSE</span>
<span class="co">#&gt; 5 0.03 0.84   FALSE   FALSE</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Atra</span>,<span class="fu"><a href="../reference/cen_paired.html">cen_paired</a></span><span class="op">(</span><span class="va">June</span>, <span class="va">JuneCen</span>, <span class="va">Sept</span>, <span class="va">SeptCen</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Censored paired test for mean(June - Sept) equals 0. </span>
<span class="co">#&gt;  alternative hypothesis: true mean difference does not equal 0. </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  n = 24   Z= -1.0924   p-value = 0.2747 </span>
<span class="co">#&gt;  Mean difference = -3.927</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-27-1.png" width="624" style="display: block; margin: auto;"></p>
<p>The p-value is well above 0.05. Do not reject that the mean difference in concentration for the two months could be 0.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># test for the median difference = 0 using the sign test.</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Atra</span>,<span class="fu"><a href="../reference/cen_signtest.html">cen_signtest</a></span><span class="op">(</span><span class="va">June</span>, <span class="va">JuneCen</span>, <span class="va">Sept</span>, <span class="va">SeptCen</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Censored sign test for median(x:June - y:Sept) equals 0 </span>
<span class="co">#&gt;    alternative hypothesis: true median difference is not = 0 </span>
<span class="co">#&gt;    n = 24   n+ = 3   n- = 16    ties: 5 </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;   No correction for ties:   p-value = 0.004425 </span>
<span class="co">#&gt; Fong correction for ties:   p-value = 0.08956</span></code></pre></div>
<p>Because it is important to correct for the numbers of tied values within a pair, the p-value of 0.089 results in the conclusion to not reject that the median difference in concentration between the two months could be 0.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># test for a difference in the cdfs of the two months using the signed-rank</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Atra</span>,<span class="fu"><a href="../reference/cen_signedranktest.html">cen_signedranktest</a></span><span class="op">(</span><span class="va">June</span>, <span class="va">JuneCen</span>, <span class="va">Sept</span>, <span class="va">SeptCen</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Censored signed-rank test for (x:June - y:Sept) equals 0</span>
<span class="co">#&gt; alternative hypothesis: true difference June - Sept does not equal 0</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  Pratt correction for ties </span>
<span class="co">#&gt; n = 24, Z = -3.319, p.value = 0.0009033</span></code></pre></div>
<p>The signed-rank test has more power to see differences than did the sign test. It also is comparing the cdfs, the entire set of percentiles, between the two months. It finds a difference because the upper end of the distribution is quite a bit higher in the Sept data.</p>
</div>
<div id="comparing-data-to-standards-using-an-upper-confidence-limit" class="section level3">
<h3 class="hasAnchor">
<a href="#comparing-data-to-standards-using-an-upper-confidence-limit" class="anchor"></a>Comparing Data to Standards Using an Upper Confidence Limit</h3>
<p>Using the Example 1 data, compute the UCL95 for censored data.</p>
<p><strong>Step 1.</strong> Sample size. There are 21 observations. Since it is on the borderline for deciding whether to use a distributional or nonparametric method, both will be demonstrated here.</p>
<p><strong>Step 2. Distributional Method</strong></p>
<p>Draw the boxplot for “censored data” (data with nondetects).</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Example1</span>,
     <span class="fu"><a href="../reference/cboxplot.html">cboxplot</a></span><span class="op">(</span><span class="va">Arsenic</span>, <span class="va">NDisTRUE</span>, Ylab<span class="op">=</span><span class="st">"Arsenic Conc"</span>, show <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-30-1.png" width="624" style="display: block; margin: auto;"></p>
<p>Note that the highest detection limit is drawn as the horizontal dashed line at 4 ug/L. Everything below that includes values estimated using a lognormal ROS. Three “outliers” (not ‘bad data’) lie above the estimated whisker, showing that the data are skewed.</p>
<p>Decide which of three distributions best fits the data using the <code>cenCompareCdfs</code> command. Choose the distribution with the smallest BIC.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Example1</span>,
     <span class="fu"><a href="../reference/cenCompareCdfs.html">cenCompareCdfs</a></span> <span class="op">(</span><span class="va">Arsenic</span>, <span class="va">NDisTRUE</span>, Yname <span class="op">=</span> <span class="st">"Arsenic concentration in ug/L"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-31-1.png" width="624" style="display: block; margin: auto;"></p>
<p>The gamma distribution has the smallest BIC.</p>
<p>Note that the curve representing the normal distribution dips below zero (x=0) at about the 10th percentile. A distribution of concentrations with 10% negative numbers is not realistic, which results in a higher BIC statistic.</p>
<p>Use the best-fit distribution (gamma) from 2b to compute the UCL95.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">egam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Example1</span>,
             <span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/egammaAltCensored.html">egammaAltCensored</a></span><span class="op">(</span><span class="va">Arsenic</span>, <span class="va">NDisTRUE</span>, 
                               ci<span class="op">=</span><span class="cn">TRUE</span>, ci.type <span class="op">=</span> <span class="st">"upper"</span>,
                               ci.method <span class="op">=</span> <span class="st">"normal.approx"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">EnvStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/print.html">print</a></span><span class="op">(</span><span class="va">egam</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results of Distribution Parameter Estimation</span>
<span class="co">#&gt; Based on Type I Censored Data</span>
<span class="co">#&gt; --------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Distribution:            Gamma</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Side:                  left</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Level(s):              0.5 2.0 3.0 4.0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated Parameter(s):          mean = 1.8399269</span>
<span class="co">#&gt;                                  cv   = 0.9131572</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimation Method:               MLE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data:                            Arsenic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Variable:              NDisTRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Size:                     21</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Percent Censored:                66.66667%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval for:         mean</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Method:      Normal Approximation</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Type:        upper</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Level:                95%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval:             LCL =     -Inf</span>
<span class="co">#&gt;                                  UCL = 2.575537</span></code></pre></div>
<p>Use the print statement to get the “table format” for the output from this EnvStats function. The UCL95 equals 2.57 assuming a gamma distribution. Because this is lower than the 10 ug/L standard, the null hypothesis of non-compliance is rejected, and the site from which these data came is found to be in compliance.</p>
<p><strong>Step 3. Nonparametric Method</strong></p>
<p><strong>Example 1:</strong></p>
<p>There are multiple detection limits for this arsenic data. Compute the Kaplan-Meier estimate of the mean and percentile bootstrap UCL95, the latter because of the high percent of nondetects (66.67%) in the data.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">arsenic.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Example1</span>,
                    <span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/enparCensored.html">enparCensored</a></span><span class="op">(</span><span class="va">Arsenic</span>, <span class="va">NDisTRUE</span>, 
                                  ci<span class="op">=</span><span class="cn">TRUE</span>, ci.method<span class="op">=</span><span class="st">"bootstrap"</span>, ci.type<span class="op">=</span><span class="st">"upper"</span>,
                                  n.bootstraps<span class="op">=</span><span class="fl">5000</span><span class="op">)</span><span class="op">)</span>
<span class="fu">EnvStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/print.html">print</a></span><span class="op">(</span><span class="va">arsenic.out</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results of Distribution Parameter Estimation</span>
<span class="co">#&gt; Based on Type I Censored Data</span>
<span class="co">#&gt; --------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Distribution:            None</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Side:                  left</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Level(s):              0.5 2.0 3.0 4.0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated Parameter(s):          mean    = 1.7169702</span>
<span class="co">#&gt;                                  sd      = 1.5928374</span>
<span class="co">#&gt;                                  se.mean = 0.1159666</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimation Method:               Kaplan-Meier</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data:                            Arsenic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Variable:              NDisTRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Size:                     21</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Percent Censored:                66.66667%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval for:         mean</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Sample Size:             21</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Method:      Bootstrap</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstraps:            5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstrap Samples</span>
<span class="co">#&gt; With No Censored Values:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Times Bootstrap</span>
<span class="co">#&gt; Repeated Because Too Few</span>
<span class="co">#&gt; Uncensored Observations:         19</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Type:        upper</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Level:                95%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval:             Pct.LCL = 0.000000</span>
<span class="co">#&gt;                                  Pct.UCL = 2.537526</span>
<span class="co">#&gt;                                  BCa.LCL = 0.000000</span>
<span class="co">#&gt;                                  BCa.UCL = 2.549995</span>
<span class="co">#&gt;                                  t.LCL   = 0.000000</span>
<span class="co">#&gt;                                  t.UCL   = 3.733438</span></code></pre></div>
<p>The percentile bootstrap estimate of the UCL95 will be near to 2.53, with the output varying slightly each time a bootstrap estimate is run. This is essentially the same estimate as that for the gamma distribution, with the identical result – the site is found to be in compliance.</p>
<p><strong>Example 2:</strong> Computation of a UCL95 for data with both detected and non-detected values, DL unknown.</p>
<p>Data: Methyl Isobutyl Ketone (MIBK) in air above a medium-sized US city.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Example2</span><span class="op">)</span></code></pre></div>
<p><em>A: Computation of the mean and UCL95</em></p>
<p>The MIBK concentrations are given as reported in column 1 – no detection limit was provided. Nondetects were designated only as ND. The lowest detected value in the data equals 0.1229. Assuming all ND values are lower than this, all NDs were changed to &lt;0.1229 as shown in the MIBK and MIBKcen columns.</p>
<p>This results in only one reporting limit in the data, so the Kaplan-Meier estimate will be biased a bit high. Instead, use the robust ROS method with bootstrapping:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mibk.ucl95</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Example2</span>, 
                   <span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/elnormAltCensored.html">elnormAltCensored</a></span> <span class="op">(</span><span class="va">MIBK</span>, <span class="va">MIBKcen</span>, method <span class="op">=</span> <span class="st">"rROS"</span>, 
                                      ci<span class="op">=</span><span class="cn">TRUE</span>, ci.method <span class="op">=</span> <span class="st">"bootstrap"</span>, 
                                      ci.type <span class="op">=</span> <span class="st">"upper"</span>, n.bootstraps <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span><span class="op">)</span>
<span class="fu">EnvStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/print.html">print</a></span><span class="op">(</span><span class="va">mibk.ucl95</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results of Distribution Parameter Estimation</span>
<span class="co">#&gt; Based on Type I Censored Data</span>
<span class="co">#&gt; --------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Distribution:            Lognormal</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Side:                  left</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Level(s):              0.1229 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated Parameter(s):          mean = 0.2160198</span>
<span class="co">#&gt;                                  cv   = 0.9338747</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimation Method:               Imputation with</span>
<span class="co">#&gt;                                  Q-Q Regression (rROS)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data:                            MIBK</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Variable:              MIBKcen</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Size:                     31</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Percent Censored:                48.3871%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval for:         mean</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Method:      Bootstrap</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstraps:            5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstrap Samples</span>
<span class="co">#&gt; With No Censored Values:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Times Bootstrap</span>
<span class="co">#&gt; Repeated Because Too Few</span>
<span class="co">#&gt; Uncensored Observations:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Type:        upper</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Level:                95%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval:             Pct.LCL = 0.0000000</span>
<span class="co">#&gt;                                  Pct.UCL = 0.2912458</span>
<span class="co">#&gt;                                  BCa.LCL = 0.0000000</span>
<span class="co">#&gt;                                  BCa.UCL = 0.2691293</span></code></pre></div>
<p>The percentile bootstrap UCL95 based on the robust ROS mean equals 0.290 (the Kaplan-Meier estimate with the slight bias would have equaled 0.293). Remember that your bootstrap result will slightly differ from the one here. To decrease differences between runs, increase the number of bootstraps, say to 10,000.</p>
<p><em>B: What if the detection limit had been known?</em></p>
<p>If a reporting limit of 0.029 had been provided by the laboratory, the data would be as given in the MIBK2 and MIBK2cen columns. Using the same procedure gives slightly lower results for both mean and UCL95:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mibk2.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Example2</span>, 
                  <span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/elnormAltCensored.html">elnormAltCensored</a></span> <span class="op">(</span><span class="va">MIBK2</span>, <span class="va">MIBK2cen</span>, method <span class="op">=</span> <span class="st">"rROS"</span>, 
                                     ci<span class="op">=</span><span class="cn">TRUE</span>, ci.method <span class="op">=</span> <span class="st">"bootstrap"</span>, 
                                     ci.type <span class="op">=</span> <span class="st">"upper"</span>, n.bootstraps <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span><span class="op">)</span>
<span class="fu">EnvStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/print.html">print</a></span><span class="op">(</span><span class="va">mibk2.out</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results of Distribution Parameter Estimation</span>
<span class="co">#&gt; Based on Type I Censored Data</span>
<span class="co">#&gt; --------------------------------------------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Assumed Distribution:            Lognormal</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Side:                  left</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Level(s):              0.029 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated Parameter(s):          mean = 0.2146941</span>
<span class="co">#&gt;                                  cv   = 0.9436391</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimation Method:               Imputation with</span>
<span class="co">#&gt;                                  Q-Q Regression (rROS)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data:                            MIBK2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Censoring Variable:              MIBK2cen</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Size:                     31</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Percent Censored:                48.3871%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval for:         mean</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Method:      Bootstrap</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstraps:            5000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Bootstrap Samples</span>
<span class="co">#&gt; With No Censored Values:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Times Bootstrap</span>
<span class="co">#&gt; Repeated Because Too Few</span>
<span class="co">#&gt; Uncensored Observations:         0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval Type:        upper</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Level:                95%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence Interval:             Pct.LCL = 0.0000000</span>
<span class="co">#&gt;                                  Pct.UCL = 0.2828038</span>
<span class="co">#&gt;                                  BCa.LCL = 0.0000000</span>
<span class="co">#&gt;                                  BCa.UCL = 0.2756098</span></code></pre></div>
<p>The percentile bootstrap UCL95 based on the robust ROS mean will be near to 0.290 with this known detection limit. It is always better to use the laboratory documented limit, but not having one should not stop the user from computing estimates using the lowest detected observation as the limit.</p>
<p><strong>Example 3:</strong> Computation of the expected percent of observations exceeding a health advisory when all data are NDs. More details of this method are found in Chapter 8 of Statistics for Censored Environmental Data Using Minitab and R (Helsel, 2012).</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Example3</span><span class="op">)</span></code></pre></div>
<p>All detection limits used are below the 10 ppb drinking water MCL for arsenic. Therefore we know that 0 out of 14 current observations exceed the MCL of 10 ppb. What is the range of percent of observations in the aquifer that might exceed the MCL (with 95% probability)? Use the binomial test command, entering the number of observations in the dataset that exceed the MCL (0) and the number of total observations (14). The <code>alternative =”less”</code> option states that this is a one-sided confidence interval – we are looking only for possible exceedances, nothing on the low end.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html">binom.test</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">14</span>,alternative<span class="op">=</span><span class="st">"less"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Exact binomial test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  0 and 14</span>
<span class="co">#&gt; number of successes = 0, number of trials = 14, p-value = 6.104e-05</span>
<span class="co">#&gt; alternative hypothesis: true probability of success is less than 0.5</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  0.0000000 0.1926362</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; probability of success </span>
<span class="co">#&gt;                      0</span></code></pre></div>
<p>Most of what is returned concerns a test for whether the proportion of observations above the MCL differs from 50%, but this test is of no interest here. What is of interest is the confidence interval on the proportion of observations in the population that could be above the MCL, based on the 14 samples observed. The UCL95 of the proportion equals 0.192. Therefore we can say with 95% probability that there are no more than 19.2% of concentrations in the aquifer exceeding the MCL – we expect that there are fewer because the MCL of 10 is considerably above the highest detection limit of 4 ppb, and this interval is actually the probability of exceeding 4 ppb. Taking this conservative approach that the probability of values falling above 4 ppb is the same probability of falling above 10 ppb, the expected percent of samples at this location above the MCL of 10 ppb is no more than 19.2%. This range could be tightened by taking more samples, of course. For other questions that can be answered when all values are nondetects, see Chapter 8 in Helsel (2012).</p>
</div>
</div>
<div id="two-group-tests" class="section level2">
<h2 class="hasAnchor">
<a href="#two-group-tests" class="anchor"></a>Two-Group Tests</h2>
<p>The MLE version of a “t-test” for censored data uses an MLE regression with one X variable, a 0/1 group indicator. Assuming a normal distribution:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">CuZn</span>,<span class="fu"><a href="../reference/cen2means.html">cen2means</a></span><span class="op">(</span><span class="va">Zn</span>,<span class="va">ZnCen</span>,<span class="va">Zone</span>,LOG<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;      MLE 't-test' of mean CensData: Zn   by Factor: Zone </span>
<span class="co">#&gt;      Assuming normal distribution of residuals around group means </span>
<span class="co">#&gt;      mean of AlluvialFan = 11.49     mean of BasinTrough = 18.13 </span>
<span class="co">#&gt;      Chisq = 0.2928  on 1 degrees of freedom     p = 0.588</span>
<span class="co">#&gt; Warning in cen2means(Zn, ZnCen, Zone, LOG = FALSE): NOTE: Data with nondetects may be projected below 0 with MLE normal distribution. </span>
<span class="co">#&gt;    If so, p-values will be unreliable (often too small).  Use perm test instead.</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-39-1.png" width="624" style="display: block; margin: auto;"></p>
<p>No difference between group means can be seen. But do the residuals follow a normal distribution, as required? The corresponding Q-Q plot of regression residuals and corresponding Shapiro-Francia test show that the data do not follow a normal distribution.</p>
<p>MLE also builds a model of the two groups after estimating their mean and standard deviations. When assuming a normal distribution with data close to zero it is easy for the model to project data down below zero. Besides being unrealistic, this can lead to a false separation between the groups and p-values that are too low. To avoid this, either assume a lognormal distribution (the default, or use LOG=TRUE) or use a permutation test instead.</p>
<p>Use the cenperm2 function to perform a two-group permutation test. This avoids an assumption of a normal distribution while testing for differences in means:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">CuZn</span>,<span class="fu"><a href="../reference/cenperm2.html">cenperm2</a></span><span class="op">(</span><span class="va">Zn</span>,<span class="va">ZnCen</span>,<span class="va">Zone</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;  Permutation test of mean CensData: Zn   by Factor: Zone </span>
<span class="co">#&gt;      9999 Permutations     alternative = two.sided </span>
<span class="co">#&gt;   mean of AlluvialFan = 21.22 to 23.51     mean of BasinTrough = 21.28 to 21.94 </span>
<span class="co">#&gt;      Mean (AlluvialFan - BasinTrough) =  -0.05612 to 1.567       p = 1 to 0.9986 </span>
<span class="co">#&gt; </span></code></pre></div>
<p>The two groups do not have significantly different means. These are p-values that you can believe, as they do not depend on the normal assumption and do not project data values below zero.</p>
<p>Using cen2means to perform the test using the default lognormal distribution, the difference in geometric means (not arithmetic means) is performed below.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">CuZn</span>,<span class="fu"><a href="../reference/cen2means.html">cen2means</a></span><span class="op">(</span><span class="va">Zn</span>,<span class="va">ZnCen</span>,<span class="va">Zone</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;      MLE 't-test' of mean natural logs of CensData: Zn by Factor: Zone </span>
<span class="co">#&gt;      Assuming lognormal distribution of residuals around group geometric means </span>
<span class="co">#&gt;      geometric mean of AlluvialFan = 11.78     geometric mean of BasinTrough = 15.24 </span>
<span class="co">#&gt;      Chisq = 2.547  on 1 degrees of freedom     p = 0.11 </span>
<span class="co">#&gt; </span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-41-1.png" width="624" style="display: block; margin: auto;"></p>
<p>No significant difference between geometric means. And the corresponding Q-Q plot of regression residuals show that the data do not follow a lognormal distribution either (one large outlier), but it is the better fit of the two distributions. A permutation test using cenperm2 after computing the logarithms would be a better test for differences in geometric means.</p>
<p>"A nonparametric test between the two groups will test differences between their cdfs (often considered as a test for difference in medians) instead of testing the difference between means. The Peto-Peto test is run using the cen1way function. It reports the Kaplan-Meier medians in each of the groups:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">CuZn</span>,<span class="fu"><a href="../reference/cen1way.html">cen1way</a></span><span class="op">(</span><span class="va">Zn</span>,<span class="va">ZnCen</span>,<span class="va">Zone</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;             grp    N   PctND   KMmean    KMsd   KMmedian</span>
<span class="co">#&gt; 1   AlluvialFan   67   23.88    22.70   74.03         10</span>
<span class="co">#&gt; 2   BasinTrough   50    8.00    21.61   18.77         20</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;       Oneway Peto-Peto test of CensData: Zn   by Factor: Zone </span>
<span class="co">#&gt;       Chisq = 5.183   on 1 degrees of freedom     p = 0.0228</span></code></pre></div>
<p>The two group medians (10 vs 17) are found different at p = 0.0228, without assuming normality or substituting anything for the nondetects censored at multiple (in this case, two) reporting limits. The cdfs for the two groups are also shown, drawn using the cen_ecdf function.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">CuZn</span>,<span class="fu"><a href="../reference/cen_ecdf.html">cen_ecdf</a></span> <span class="op">(</span><span class="va">Zn</span>,<span class="va">ZnCen</span>,<span class="va">Zone</span>,
                    Ylab<span class="op">=</span><span class="st">"Zinc Concentration, in ug/L"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-43-1.png" width="624" style="display: block; margin: auto;"></p>
<p>Above approximately the 40th percentile or so, the Basin Trough (dashed line) data are higher than (to the right of) the Alluvial Fan data. Boxplots might show the group differences better than do the cdfs, especially for non-statisticians.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">CuZn</span>,<span class="fu"><a href="../reference/cboxplot.html">cboxplot</a></span><span class="op">(</span><span class="va">Zn</span>,<span class="va">ZnCen</span>,<span class="va">Zone</span>,
                    Ylab<span class="op">=</span><span class="st">"Zinc Concentration, in ug/L"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-44-1.png" width="624" style="display: block; margin: auto;"></p>
<p>Now for the two simpler tests, where all values below the highest DL must be re-censored.</p>
<p>Contingency tables are a test to determine whether the proportions of data in categories are the same in two or more groups. With nondetects the cutoff level is again the highest reporting limit. Use the <code>TCE2</code> dataset with the highest of 4 DLs at 5 ug/L. The test determines whether the proportions of data above versus below the cutoff are the same in each group. It differs from a rank-sum in that all data above the limit are simply in the same ‘Above’ group rather than ranked individually. This loses some information as compared to the rank-sum test. Density is a text variable (a factor) representing the groups, while Below5Cens has a 1 for data below 5 ug/L and a 0 for data at or above 5. First we combine them into a matrix using the ftable command, then compute a ‘cross-tabulation’ with the <code><a href="https://rdrr.io/r/stats/xtabs.html">xtabs(...)</a></code> command that the <code><a href="https://rdrr.io/r/stats/chisq.test.html">chisq.test(...)</a></code> command expects. Finally the chisquare test is computed. Its null hypothesis is that there is no difference in the percent of data above the cutoff of 5 ug/L in the two groups.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">TCE2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">TCE2</span>,<span class="fu"><a href="https://rdrr.io/r/stats/ftable.html">ftable</a></span><span class="op">(</span><span class="va">Density</span><span class="op">~</span><span class="va">Below5Cens</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;            Density High Medium</span>
<span class="co">#&gt; Below5Cens                    </span>
<span class="co">#&gt; 0                    18     12</span>
<span class="co">#&gt; 1                    74    118</span>

<span class="va">tab</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">TCE2</span>,<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span><span class="op">~</span><span class="va">Below5Cens</span><span class="op">+</span><span class="va">Density</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/chisq.test.html">chisq.test</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Pearson's Chi-squared test with Yates' continuity correction</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  tab</span>
<span class="co">#&gt; X-squared = 4.0785, df = 1, p-value = 0.04343</span></code></pre></div>
<p>The contingency table finds a difference in the proportions. It is less powerful than the rank-sum test (which will also find a difference) when there are data that can be ranked above the highest reporting limit.</p>
<p>The nonparametric Wilcoxon rank-sum test can be calculated using the <code><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test(...)</a></code> command. First you must have or create a column that contains the concentrations for all detected values at the maxDL and above, plus a single number (I use -1) below the max DL for all values below the maxDL.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TCE2</span><span class="op">$</span><span class="va">Below5</span><span class="op">[</span><span class="va">TCE2</span><span class="op">$</span><span class="va">Below5Cens</span><span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span>      <span class="co"># all &lt;5s are now a -1</span>

<span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test</a></span><span class="op">(</span><span class="va">Below5</span><span class="op">~</span><span class="va">Density</span>,<span class="va">TCE2</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Wilcoxon rank sum test with continuity correction</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  Below5 by Density</span>
<span class="co">#&gt; W = 6599.5, p-value = 0.02713</span>
<span class="co">#&gt; alternative hypothesis: true location shift is not equal to 0</span></code></pre></div>
<p>The two-sided p-value is significant at 0.027. The smaller p-value than the contingency table test reflects the additional information in the individual values at and above 5 that the rank-sum tests uses. The slightly smaller p-value for the Peto-Peto test shows that it is the most appropriate test when there are multiple detection limits.</p>
<p>Is re-censoring at the highest DL and running the rank-sum test really better than the typical method of running a t-test on data with one-half DL subbed for nondetects?</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">Half.DL</span><span class="op">~</span><span class="va">Density</span>,<span class="va">TCE2</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Welch Two Sample t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  Half.DL by Density</span>
<span class="co">#&gt; t = -0.065623, df = 201.88, p-value = 0.9477</span>
<span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  -8.073324  7.553257</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt;   mean in group High mean in group Medium </span>
<span class="co">#&gt;             7.763043             8.023077</span></code></pre></div>
<p>No significant difference found. The arbitrariness of the substitution process, not to mention that this puts the same number in many times, and so likely decreases the standard deviation artificially, should get you to quickly use a nonparametric test instead.</p>
</div>
<div id="three-or-more-groups" class="section level2">
<h2 class="hasAnchor">
<a href="#three-or-more-groups" class="anchor"></a>Three or more groups</h2>
<p>The <code>Golden</code> data present lead concentrations in organs of herons after exposing them to lead. There are four dosage groups (“Dosage” or “Group” columns), zero plus three amounts of lead. The objective was to determine if feathers or another non-destructive part of the birds could be used as an environmental indicator, so it would not be necessary to sacrifice a bird in order to measure their lead concentrations. A censored boxplot of the Golden liver lead data shows that the third and fourth groups have generally higher values.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Golden</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Golden</span>,<span class="fu"><a href="../reference/cboxplot.html">cboxplot</a></span><span class="op">(</span><span class="va">Liver</span>, <span class="va">LiverCen</span>, <span class="va">Dosage</span>,
                     Ylab <span class="op">=</span> <span class="st">"Lead concentrations in liver, in ppb"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-48-1.png" width="624" style="display: block; margin: auto;"></p>
<p>The skewness of the 0.05 group and the outlier of the 0.25 group indicates that logs should end up being the better set of units to use.</p>
<div id="kruskal-wallis-test" class="section level3">
<h3 class="hasAnchor">
<a href="#kruskal-wallis-test" class="anchor"></a>Kruskal-Wallis test</h3>
<p>First the groups can be compared using a Kruskal-Wallis test, setting all values below the highest detection limit of 0.04 as tied. Note that there are detected observations below 0.04, so either the data had a second and lower detection limit with no nondetects below it, or more likely were reported using “insider censoring” (see <em>Statistics for Censored Environmental Data Using Minitab and R</em> to find out what that is and the problem it causes).</p>
<p><strong>Step 1</strong> - Create a variable – call it Below04 – with zeros (or -1, or any value below the highest DL) for all data below the highest DL of 0.04. Be careful not just to assign all 0.04s as nondetects, as some of these could be detected 0.04s. Instead, use two steps, the first to set all values BELOW 0.04 as a 0 (or -1), and the second to set all data marked as nondetects (which will include the &lt;0.04 values) as a 0 (or -1). The result is a variable with an indicator (-1 recommended) for all data below the highest reporting limit, and original values for all detected data at and above the highest reporting limit. The logical operators &lt; (less-than) and == (equal to) are used here.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Golden</span><span class="op">$</span><span class="va">Below04</span> <span class="op">&lt;-</span> <span class="va">Golden</span><span class="op">$</span><span class="va">Liver</span>
<span class="va">Golden</span><span class="op">$</span><span class="va">Below04</span><span class="op">[</span><span class="va">Golden</span><span class="op">$</span><span class="va">Liver</span><span class="op">&lt;</span><span class="fl">0.04</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span>
<span class="va">Golden</span><span class="op">$</span><span class="va">Below04</span><span class="op">[</span><span class="va">Golden</span><span class="op">$</span><span class="va">LiverCen</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span></code></pre></div>
<p><strong>Step 2</strong> - run the Kruskal-Wallis test</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/kruskal.test.html">kruskal.test</a></span><span class="op">(</span><span class="va">Below04</span><span class="op">~</span><span class="va">Dosage</span>,<span class="va">Golden</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Kruskal-Wallis rank sum test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  Below04 by Dosage</span>
<span class="co">#&gt; Kruskal-Wallis chi-squared = 7.8565, df = 3, p-value = 0.04907</span></code></pre></div>
<p>The result shows that there is a difference (p = 0.049) between group medians using this simple nonparametric test. An ANOVA on data after substituting one-half DL will not find a difference (trust me on this).</p>
</div>
<div id="peto-peto-test" class="section level3">
<h3 class="hasAnchor">
<a href="#peto-peto-test" class="anchor"></a>Peto-Peto test</h3>
<p>The nonparametric Peto-Peto test, the multi-DL nonparametric test, is computed using the <code><a href="../reference/cen1way.html">cen1way(...)</a></code> command:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Golden</span>,<span class="fu"><a href="../reference/cen1way.html">cen1way</a></span><span class="op">(</span><span class="va">Liver</span>,<span class="va">LiverCen</span>,<span class="va">Dosage</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: One or more group(s) do not have censored data.</span>

<span class="co">#&gt; Warning: One or more group(s) do not have censored data.</span>
<span class="co">#&gt;      grp   N   PctND    KMmean       KMsd   KMmedian</span>
<span class="co">#&gt; 1      0   7   28.57    0.1020    0.08834    0.09893</span>
<span class="co">#&gt; 2   0.01   7   28.57    0.1384    0.10590     0.1748</span>
<span class="co">#&gt; 3   0.05   6    0.00   12.1100   16.16000      3.639</span>
<span class="co">#&gt; 4   0.25   7    0.00    6.8660   17.46000     0.2615</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;       Oneway Peto-Peto test of CensData: Liver   by Factor: Dosage </span>
<span class="co">#&gt;       Chisq = 7.795   on 3 degrees of freedom     p = 0.0504 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Pairwise comparisons using Peto &amp; Peto test </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  CensData and Factor </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      0     0.01  0.05 </span>
<span class="co">#&gt; 0.01 0.887 -     -    </span>
<span class="co">#&gt; 0.05 0.171 0.321 -    </span>
<span class="co">#&gt; 0.25 0.079 0.127 0.887</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; P value adjustment method: BH</span></code></pre></div>
<p>The cdfs show that the higher two groups appear to differ in their percentiles as compared to the lower two groups.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Golden</span>,<span class="fu"><a href="../reference/cen_ecdf.html">cen_ecdf</a></span><span class="op">(</span><span class="va">Liver</span>,<span class="va">LiverCen</span>,<span class="va">Dosage</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-52-1.png" width="624" style="display: block; margin: auto;"></p>
<p>This is more easily seen by plotting the empirical cdfs in log units:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Golden</span><span class="op">$</span><span class="va">lnLiver</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">Golden</span><span class="op">$</span><span class="va">Liver</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Golden</span>,<span class="fu"><a href="../reference/cen_ecdf.html">cen_ecdf</a></span><span class="op">(</span><span class="va">lnLiver</span>,<span class="va">LiverCen</span>,<span class="va">Dosage</span>,
                     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">lnLiver</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">lnLiver</span><span class="op">)</span><span class="op">)</span>, 
                     Ylab <span class="op">=</span> <span class="st">"Natural Logs of Lead Concentrations in Liver"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-53-1.png" width="624" style="display: block; margin: auto;"></p>
<p>The 0.05 and 0.025 groups appear to have the higher liver lead concentrations (are further to the right) than the other two groups.</p>
</div>
<div id="the-mle-anova" class="section level3">
<h3 class="hasAnchor">
<a href="#the-mle-anova" class="anchor"></a>The MLE “ANOVA”</h3>
<p>For the parametric approach, use the <code><a href="../reference/cenanova.html">cenanova(...)</a></code> command to run a censored regression with the groups as ‘factor’ explanatory variables. By default, <code>cenanova</code> assumes the residuals follow a lognormal distribution, so use the associated Q-Q plot to see if the residuals in log units appear approximately like a normal distribution.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Golden</span>,<span class="fu"><a href="../reference/cenanova.html">cenanova</a></span><span class="op">(</span><span class="va">Liver</span>,<span class="va">LiverCen</span>,<span class="va">Dosage</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;       MLE test of mean natural logs of CensData: Liver by Factor: Dosage </span>
<span class="co">#&gt;       Assuming lognormal distribution of CensData </span>
<span class="co">#&gt;       Chisq = 10.67  on 3 degrees of freedom     p = 0.0137 </span>
<span class="co">#&gt; </span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-54-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;       mean(0)   mean(0.01)   mean(0.05)   mean(0.25)
#&gt;     -2.989004    -2.701335    0.3031636   -0.7304445
#&gt; 
#&gt;   Simultaneous Tests for General Linear Hypotheses
#&gt; 
#&gt; Multiple Comparisons of Means: Tukey Contrasts
#&gt; 
#&gt; 
#&gt; Fit: survreg(formula = logCensData ~ Factor, dist = "gaussian")
#&gt; 
#&gt; Linear Hypotheses:
#&gt;                  Estimate Std. Error z value Pr(&gt;|z|)  
#&gt; 0.01 - 0 == 0      0.2877     1.0841   0.265   0.9935  
#&gt; 0.05 - 0 == 0      3.2922     1.1036   2.983   0.0151 *
#&gt; 0.25 - 0 == 0      2.2586     1.0625   2.126   0.1448  
#&gt; 0.05 - 0.01 == 0   3.0045     1.1010   2.729   0.0320 *
#&gt; 0.25 - 0.01 == 0   1.9709     1.0599   1.860   0.2456  
#&gt; 0.25 - 0.05 == 0  -1.0336     1.0749  -0.962   0.7712  
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; (Adjusted p values reported -- single-step method)</code></pre>
<p>The overall test has a p-value of 0.014. Therefore the four group mean logarithms (geometric means) differ. p-values for the individual pairwise tests of differences show differences in two pairs of groups. The p-values of 0.0150 (0.05 versus 0 groups) and 0.0323 (0.05 versus 0.01 groups) show that the 0.05 group differs from the lowest two groups, but not from the 0.25 group. The residuals plot shows that log are a very good set of units to use, as their residuals are close to a normal distribution:</p>
<p>If instead you had wanted to test differences in the arithmetic means, use a permutation test as a normal distribution will not fit these data very well.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Golden</span>,<span class="fu"><a href="../reference/cenpermanova.html">cenpermanova</a></span><span class="op">(</span><span class="va">Liver</span>,<span class="va">LiverCen</span>,<span class="va">Dosage</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;  Permutation test of mean CensData: Liver   by Factor: Dosage </span>
<span class="co">#&gt;      9999 Permutations </span>
<span class="co">#&gt; Test Statistic = 1211 to 1211       p = 0.1369 to 0.1382 </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;    mean(0)   mean(0.01)   mean(0.05)   mean(0.25)   </span>
<span class="co">#&gt;     0.1000       0.1395      12.1100       6.8660</span></code></pre></div>
<p>No significant difference in the means was found. This test did not assume a normal distribution, though it is still influenced by outliers because it evaluates means, which are influenced by outliers. The permutation test will not extrapolate data to values below zero as would MLE.</p>
<p>Note that the means of two groups, and so much of the data in the two groups, falls below zero when estimated by MLE assuming a normal distribution:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Golden</span>,<span class="fu"><a href="../reference/cenanova.html">cenanova</a></span><span class="op">(</span><span class="va">Liver</span>,<span class="va">LiverCen</span>,<span class="va">Dosage</span>,LOG<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;       MLE test of mean CensData: Liver   by Factor: Dosage </span>
<span class="co">#&gt;       Assuming normal distribution of CensData </span>
<span class="co">#&gt;       Chisq = 6.889  on 3 degrees of freedom     p = 0.0755 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    NOTE: Data with nondetects may be projected below 0 with MLE normal distribution. </span>
<span class="co">#&gt;    If so, p-values will be unreliable (often too small).  Use perm test instead. </span>
<span class="co">#&gt; </span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-56-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;       mean(0)   mean(0.01)   mean(0.05)   mean(0.25)
#&gt;     -2.889326    -2.847255     12.11417     6.865988
#&gt; 
#&gt;   Simultaneous Tests for General Linear Hypotheses
#&gt; 
#&gt; Multiple Comparisons of Means: Tukey Contrasts
#&gt; 
#&gt; 
#&gt; Fit: survreg(formula = CensData ~ Factor, dist = "gaussian")
#&gt; 
#&gt; Linear Hypotheses:
#&gt;                  Estimate Std. Error z value Pr(&gt;|z|)
#&gt; 0.01 - 0 == 0     0.04207    6.65879   0.006    1.000
#&gt; 0.05 - 0 == 0    15.00349    6.71721   2.234    0.114
#&gt; 0.25 - 0 == 0     9.75531    6.47075   1.508    0.433
#&gt; 0.05 - 0.01 == 0 14.96142    6.71674   2.227    0.116
#&gt; 0.25 - 0.01 == 0  9.71324    6.47026   1.501    0.437
#&gt; 0.25 - 0.05 == 0 -5.24818    6.50033  -0.807    0.851
#&gt; (Adjusted p values reported -- single-step method)</code></pre>
<p>The p-value of 0.0755 is too small because the group differences are exaggerated by pushing data down below 0. Given that the actual data cannot go below zero, the cenpermanova p-value of 0.14 is a much more realistic test result.</p>
</div>
</div>
<div id="correlation-and-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#correlation-and-regression" class="anchor"></a>Correlation and Regression</h2>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Recon</span><span class="op">)</span></code></pre></div>
<p>First test for high vifs by computing a standard regression equation that ignores the censoring indicator column, ignoring all results except for the vifs:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/rms/man/vif.html">vif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">AtraConc</span> <span class="op">~</span> <span class="va">Area</span> <span class="op">+</span> <span class="va">Applic</span> <span class="op">+</span> <span class="va">PctCorn</span> <span class="op">+</span> <span class="va">SoilGp</span> <span class="op">+</span> <span class="va">Temp</span> <span class="op">+</span> <span class="va">Precip</span> <span class="op">+</span> <span class="va">Dyplant</span> <span class="op">+</span> <span class="va">Pctl</span>,<span class="va">Recon</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;     Area   Applic  PctCorn   SoilGp     Temp   Precip  Dyplant     Pctl </span>
<span class="co">#&gt; 1.101992 2.739602 1.996707 1.480307 2.587299 2.206457 1.068839 1.131753</span></code></pre></div>
<p>All of the variables appear uncorrelated with the others (all VIFs well below 10). Therefore the p-values obtained in regression should be reliable.</p>
<p><strong>Step 1</strong> - Create the 8-X variable <code>data.frame</code> and run the regression with all variables. Decide which scale the Y variable should be used (no transformation, log, cube-root).</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recon.8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">Area</span>, <span class="va">Applic</span>, <span class="va">PctCorn</span>, <span class="va">SoilGp</span>, <span class="va">Temp</span>, <span class="va">Precip</span>, <span class="va">Dyplant</span>, <span class="va">Pctl</span><span class="op">)</span><span class="op">)</span>
<span class="va">reg.recon.8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/cencorreg.html">cencorreg</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">recon.8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-59-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code><a href="https://rdrr.io/r/base/summary.html">#&gt;  Likelihood R2 = 0.6387                     AIC = 804.4707 
#&gt;  Rescaled Likelihood R2 = 0.6771            BIC = 843.968 
#&gt;  McFaddens R2 = 0.3547157 
#&gt; 

summary(reg.recon.8)
#&gt; 
#&gt; Call:
#&gt; survreg(formula = "log(AtraConc)", data = "Area+Applic+PctCorn+SoilGp+Temp+Precip+Dyplant+Pctl", 
#&gt;     dist = "gaussian")
#&gt;                 Value Std. Error      z       p
#&gt; (Intercept) -8.76e+00   1.25e+00  -7.00 2.6e-12
#&gt; Area         2.19e-05   1.98e-05   1.11  0.2685
#&gt; Applic      -2.75e-02   1.73e-02  -1.59  0.1127
#&gt; PctCorn      5.91e-02   1.88e-02   3.14  0.0017
#&gt; SoilGp       2.35e-01   3.66e-01   0.64  0.5198
#&gt; Temp         6.25e-01   1.15e-01   5.44 5.3e-08
#&gt; Precip      -5.18e-03   1.39e-02  -0.37  0.7087
#&gt; Dyplant     -1.86e-02   1.51e-03 -12.36 &lt; 2e-16
#&gt; Pctl         4.17e-02   4.45e-03   9.36 &lt; 2e-16
#&gt; Log(scale)   5.96e-01   6.12e-02   9.75 &lt; 2e-16
#&gt; 
#&gt; Scale= 1.82 
#&gt; 
#&gt; Gaussian distribution
#&gt; Loglik(model)= -391.7   Loglik(intercept only)= -607.1
#&gt;  Chisq= 430.68 on 8 degrees of freedom, p= 5.1e-88 
#&gt; Number of Newton-Raphson Iterations: 6 
#&gt; n= 423</a></code></pre>
<p>The Rescaled likelihood R is fairly high (0.82) and the AIC equals 804.4. The Q-Q plot (below) shows a fairly straight pattern of data and W = 0.966, so it would be difficult to find a better transformation of the Y variable than the log. Use log Y.</p>
<p><strong>Step 2</strong> - Decide whether to transform the scale of each X variable. Run the partplots procedure to see whether curvature in the Y-X relationship means that a transformation of the X variable should be taken.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/partplots.html">partplots</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">recon.8</span>,multiplot <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Area </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.6387                     AIC = 804.4707 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.6388                     AIC = 804.4493 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt;  Likelihood R2 = 0.6389                     AIC = 804.3342 </span>
<span class="co">#&gt; Decrease in AIC from transformation of Area = 0.1364942 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Applic </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.6387                     AIC = 804.4707 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.6378                     AIC = 805.5327 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt;  Likelihood R2 = 0.6371                     AIC = 806.3659 </span>
<span class="co">#&gt; Decrease in AIC from transformation of Applic = 0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; PctCorn </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.6387                     AIC = 804.4707 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.641                     AIC = 801.7987 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt;  Likelihood R2 = 0.6423                     AIC = 800.281 </span>
<span class="co">#&gt; Decrease in AIC from transformation of PctCorn = 4.189691 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SoilGp </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.6387                     AIC = 804.4707 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.6385                     AIC = 804.6955 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt;  Likelihood R2 = 0.6385                     AIC = 804.7786 </span>
<span class="co">#&gt; Decrease in AIC from transformation of SoilGp = 0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Temp </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.6387                     AIC = 804.4707 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.6384                     AIC = 804.8959 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt;  Likelihood R2 = 0.6381                     AIC = 805.2458 </span>
<span class="co">#&gt; Decrease in AIC from transformation of Temp = 0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Precip </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.6387                     AIC = 804.4707 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.6387                     AIC = 804.4702 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt;  Likelihood R2 = 0.6387                     AIC = 804.4687 </span>
<span class="co">#&gt; Decrease in AIC from transformation of Precip = 0.002027404 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Dyplant </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.6387                     AIC = 804.4707 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.6374                     AIC = 806.063 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt; Cannot take logs of zero or negative values. </span>
<span class="co">#&gt; Decrease in AIC from transformation of Dyplant = 0 </span>
<span class="co">#&gt; </span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-60-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt; Pctl 
#&gt;  untransformed 
#&gt;  Likelihood R2 = 0.6387                     AIC = 804.4707 
#&gt; cube root 
#&gt;  Likelihood R2 = 0.6267                     AIC = 818.3161 
#&gt; log transform 
#&gt; Cannot take logs of zero or negative values. 
#&gt; Decrease in AIC from transformation of Pctl = 0 
#&gt; </code></pre>
<p>Only PctCorn showed an appreciable drop in AIC with a transformation. As a percentage it is bounded by 0 and 100 so it’s a little odd to do a transform. However the partial plot shows an increase in the percent of “filled circle” detected observations and so a general increase in atrazine with increasing PctCorn. The relationship may be nonlinear so I’ll take the cube root of PctCorn.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Recon</span><span class="op">$</span><span class="va">cbrtPctCorn</span> <span class="op">&lt;-</span> <span class="va">recon.8</span><span class="op">$</span><span class="va">PctCorn</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>

<span class="va">recon.8onecube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">recon.8</span><span class="op">[</span>, <span class="op">-</span><span class="fl">3</span><span class="op">]</span>, <span class="va">Recon</span><span class="op">$</span><span class="va">cbrtPctCorn</span><span class="op">)</span>

<span class="va">reg.recon.8onecube</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/cencorreg.html">cencorreg</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">recon.8onecube</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-61-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;  Likelihood R2 = 0.641                     AIC = 801.7987 
#&gt;  Rescaled Likelihood R2 = 0.6795            BIC = 841.296 
#&gt;  McFaddens R2 = 0.3569165 
#&gt; </code></pre>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/partplots.html">partplots</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">recon.8onecube</span>,multiplot <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Area </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.641                     AIC = 801.7987 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.641                     AIC = 801.8123 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt;  Likelihood R2 = 0.6411                     AIC = 801.6904 </span>
<span class="co">#&gt; Decrease in AIC from transformation of Area = 0.1083058 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Applic </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.641                     AIC = 801.7987 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.6404                     AIC = 802.5295 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt;  Likelihood R2 = 0.6397                     AIC = 803.316 </span>
<span class="co">#&gt; Decrease in AIC from transformation of Applic = 0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SoilGp </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.641                     AIC = 801.7987 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.6408                     AIC = 802.0643 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt;  Likelihood R2 = 0.6407                     AIC = 802.1689 </span>
<span class="co">#&gt; Decrease in AIC from transformation of SoilGp = 0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Temp </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.641                     AIC = 801.7987 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.6404                     AIC = 802.5673 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt;  Likelihood R2 = 0.6399                     AIC = 803.0917 </span>
<span class="co">#&gt; Decrease in AIC from transformation of Temp = 0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Precip </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.641                     AIC = 801.7987 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.641                     AIC = 801.8317 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt;  Likelihood R2 = 0.641                     AIC = 801.8476 </span>
<span class="co">#&gt; Decrease in AIC from transformation of Precip = 0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Dyplant </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.641                     AIC = 801.7987 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.6391                     AIC = 804.098 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt; Cannot take logs of zero or negative values. </span>
<span class="co">#&gt; Decrease in AIC from transformation of Dyplant = 0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Pctl </span>
<span class="co">#&gt;  untransformed </span>
<span class="co">#&gt;  Likelihood R2 = 0.641                     AIC = 801.7987 </span>
<span class="co">#&gt; cube root </span>
<span class="co">#&gt;  Likelihood R2 = 0.6287                     AIC = 816.0618 </span>
<span class="co">#&gt; log transform </span>
<span class="co">#&gt; Cannot take logs of zero or negative values. </span>
<span class="co">#&gt; Decrease in AIC from transformation of Pctl = 0 </span>
<span class="co">#&gt; </span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-62-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt; Recon.cbrtPctCorn 
#&gt;  untransformed 
#&gt;  Likelihood R2 = 0.641                     AIC = 801.7987 
#&gt; cube root 
#&gt;  Likelihood R2 = 0.6419                     AIC = 800.788 
#&gt; log transform 
#&gt;  Likelihood R2 = 0.6423                     AIC = 800.281 
#&gt; Decrease in AIC from transformation of Recon.cbrtPctCorn = 1.517664 
#&gt; </code></pre>
<p>No other variables indicate a further transformation is necessary after running partplots – the cbrtPctCorn variable is already transformed so taking the log or cube root of the cube root would not make much sense.</p>
<p><strong>Step 3a</strong> - Can we lower the AIC by dropping unimportant variables?</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">reg.recon.8onecube</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; survreg(formula = "log(AtraConc)", data = "Area+Applic+SoilGp+Temp+Precip+Dyplant+Pctl+Recon.cbrtPctCorn", </span>
<span class="co">#&gt;     dist = "gaussian")</span>
<span class="co">#&gt;                       Value Std. Error      z       p</span>
<span class="co">#&gt; (Intercept)       -1.07e+01   1.58e+00  -6.74 1.6e-11</span>
<span class="co">#&gt; Area               2.04e-05   1.97e-05   1.03 0.30074</span>
<span class="co">#&gt; Applic            -2.61e-02   1.62e-02  -1.61 0.10795</span>
<span class="co">#&gt; SoilGp             2.69e-01   3.62e-01   0.74 0.45644</span>
<span class="co">#&gt; Temp               6.41e-01   1.15e-01   5.57 2.6e-08</span>
<span class="co">#&gt; Precip            -9.65e-03   1.41e-02  -0.68 0.49348</span>
<span class="co">#&gt; Dyplant           -1.86e-02   1.50e-03 -12.44 &lt; 2e-16</span>
<span class="co">#&gt; Pctl               4.16e-02   4.42e-03   9.40 &lt; 2e-16</span>
<span class="co">#&gt; Recon.cbrtPctCorn  1.23e+00   3.50e-01   3.51 0.00046</span>
<span class="co">#&gt; Log(scale)         5.89e-01   6.12e-02   9.64 &lt; 2e-16</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Scale= 1.8 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gaussian distribution</span>
<span class="co">#&gt; Loglik(model)= -390.4   Loglik(intercept only)= -607.1</span>
<span class="co">#&gt;  Chisq= 433.35 on 8 degrees of freedom, p= 1.4e-88 </span>
<span class="co">#&gt; Number of Newton-Raphson Iterations: 6 </span>
<span class="co">#&gt; n= 423</span></code></pre></div>
<p>Both Precip and Soil Gp are very non-significant. Soil Group was a number looked up in a book at the county scale and so wasn’t really expected to provide much information (your insight as a scientist is needed when using regression). Delete either Precip or Soil Group and run the 7-variable model.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># an alternative way to make a data.frame without using data.frame(...)</span>
<span class="va">recon.7</span> <span class="op">&lt;-</span> <span class="va">Recon</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Area"</span>, <span class="st">"Applic"</span>, <span class="st">"cbrtPctCorn"</span>, <span class="st">"Temp"</span>, <span class="st">"Precip"</span>, <span class="st">"Dyplant"</span>, <span class="st">"Pctl"</span><span class="op">)</span><span class="op">]</span>

<span class="va">reg.recon.7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/cencorreg.html">cencorreg</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">recon.7</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-64-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;  Likelihood R2 = 0.6405                     AIC = 800.3545 
#&gt;  Rescaled Likelihood R2 = 0.679            BIC = 835.8021 
#&gt;  McFaddens R2 = 0.3564587 
#&gt; </code></pre>
<p>AIC has decreased so this is better than the 8-variable model. The residuals plot looks much the same – this is expected in regression. The normality of residuals is primarily determined by the scale of the Y variable. Going to a six-variable model is an easy choice: Precip has a high p-value.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recon.6</span> <span class="op">&lt;-</span> <span class="va">Recon</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Area"</span>, <span class="st">"Applic"</span>, <span class="st">"cbrtPctCorn"</span>, <span class="st">"Temp"</span>,<span class="st">"Dyplant"</span>, <span class="st">"Pctl"</span><span class="op">)</span><span class="op">]</span>

<span class="va">reg.recon.6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/cencorreg.html">cencorreg</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">recon.6</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-65-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code><a href="https://rdrr.io/r/base/summary.html">#&gt;  Likelihood R2 = 0.6404                     AIC = 798.5004 
#&gt;  Rescaled Likelihood R2 = 0.6789            BIC = 829.8982 
#&gt;  McFaddens R2 = 0.3563385 
#&gt; 

summary(reg.recon.6)
#&gt; 
#&gt; Call:
#&gt; survreg(formula = "log(AtraConc)", data = "Area+Applic+cbrtPctCorn+Temp+Dyplant+Pctl", 
#&gt;     dist = "gaussian")
#&gt;                 Value Std. Error      z       p
#&gt; (Intercept) -1.02e+01   1.35e+00  -7.55 4.3e-14
#&gt; Area         2.27e-05   1.95e-05   1.16 0.24482
#&gt; Applic      -2.35e-02   1.59e-02  -1.48 0.13925
#&gt; cbrtPctCorn  1.11e+00   3.19e-01   3.48 0.00051
#&gt; Temp         6.06e-01   9.03e-02   6.71 2.0e-11
#&gt; Dyplant     -1.86e-02   1.49e-03 -12.45 &lt; 2e-16
#&gt; Pctl         4.17e-02   4.41e-03   9.45 &lt; 2e-16
#&gt; Log(scale)   5.90e-01   6.12e-02   9.65 &lt; 2e-16
#&gt; 
#&gt; Scale= 1.8 
#&gt; 
#&gt; Gaussian distribution
#&gt; Loglik(model)= -390.8   Loglik(intercept only)= -607.1
#&gt;  Chisq= 432.65 on 6 degrees of freedom, p= 2.7e-90 
#&gt; Number of Newton-Raphson Iterations: 6 
#&gt; n= 423</a></code></pre>
<p>AIC has decreased by 1.5. The next variable with a high p-value is Area. The order of deleting these 3 variables likely wouldn’t matter and you’d get to this 5 variable model even if you dropped them in a different order.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recon.5</span> <span class="op">&lt;-</span> <span class="va">Recon</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Applic"</span>, <span class="st">"cbrtPctCorn"</span>, <span class="st">"Temp"</span>,<span class="st">"Dyplant"</span>, <span class="st">"Pctl"</span><span class="op">)</span><span class="op">]</span>

<span class="va">reg.recon.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/cencorreg.html">cencorreg</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">recon.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-66-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code><a href="https://rdrr.io/r/base/summary.html">#&gt;  Likelihood R2 = 0.6393                     AIC = 797.8078 
#&gt;  Rescaled Likelihood R2 = 0.6777            BIC = 825.1559 
#&gt;  McFaddens R2 = 0.3552617 
#&gt; 

summary(reg.recon.5)
#&gt; 
#&gt; Call:
#&gt; survreg(formula = "log(AtraConc)", data = "Applic+cbrtPctCorn+Temp+Dyplant+Pctl", 
#&gt;     dist = "gaussian")
#&gt;                Value Std. Error      z       p
#&gt; (Intercept) -9.85413    1.31831  -7.47 7.7e-14
#&gt; Applic      -0.02454    0.01594  -1.54 0.12368
#&gt; cbrtPctCorn  1.10879    0.32018   3.46 0.00053
#&gt; Temp         0.58724    0.08900   6.60 4.2e-11
#&gt; Dyplant     -0.01862    0.00150 -12.45 &lt; 2e-16
#&gt; Pctl         0.04155    0.00442   9.40 &lt; 2e-16
#&gt; Log(scale)   0.59339    0.06116   9.70 &lt; 2e-16
#&gt; 
#&gt; Scale= 1.81 
#&gt; 
#&gt; Gaussian distribution
#&gt; Loglik(model)= -391.4   Loglik(intercept only)= -607.1
#&gt;  Chisq= 431.34 on 5 degrees of freedom, p= 5.2e-91 
#&gt; Number of Newton-Raphson Iterations: 6 
#&gt; n= 423</a></code></pre>
<p>AIC has decreased by 0.7, so this is a very slightly better model. The only other insignificant variable is Applic, the application amounts of ag chemicals. These are known only on a county level so are estimated by cutting and pasting county boundaries with watershed boundaries. They also are voluntary amounts, and may not always provide accurate information to the Federal government. But probably the main evidence against the variable is its negative slope – we would expect more atrazine to wash off with more applications. So we drop this variable to see its effect.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recon.4</span> <span class="op">&lt;-</span> <span class="va">Recon</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="st">"cbrtPctCorn"</span>, <span class="st">"Temp"</span>,<span class="st">"Dyplant"</span>, <span class="st">"Pctl"</span><span class="op">)</span><span class="op">]</span>

<span class="va">reg.recon.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/cencorreg.html">cencorreg</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">recon.4</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-67-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code><a href="https://rdrr.io/r/base/summary.html">#&gt;  Likelihood R2 = 0.6373                     AIC = 798.192 
#&gt;  Rescaled Likelihood R2 = 0.6756            BIC = 821.4904 
#&gt;  McFaddens R2 = 0.3532981 
#&gt; 

summary(reg.recon.4)
#&gt; 
#&gt; Call:
#&gt; survreg(formula = "log(AtraConc)", data = "cbrtPctCorn+Temp+Dyplant+Pctl", 
#&gt;     dist = "gaussian")
#&gt;                Value Std. Error      z       p
#&gt; (Intercept) -8.79657    1.10700  -7.95 1.9e-15
#&gt; cbrtPctCorn  0.81989    0.25697   3.19  0.0014
#&gt; Temp         0.51042    0.07332   6.96 3.4e-12
#&gt; Dyplant     -0.01869    0.00150 -12.47 &lt; 2e-16
#&gt; Pctl         0.04050    0.00437   9.26 &lt; 2e-16
#&gt; Log(scale)   0.59752    0.06121   9.76 &lt; 2e-16
#&gt; 
#&gt; Scale= 1.82 
#&gt; 
#&gt; Gaussian distribution
#&gt; Loglik(model)= -392.6   Loglik(intercept only)= -607.1
#&gt;  Chisq= 428.96 on 4 degrees of freedom, p= 1.5e-91 
#&gt; Number of Newton-Raphson Iterations: 6 
#&gt; n= 423</a></code></pre>
<p>The AIC goes up but only a little. This would be the scientist’s choice to use either the 5-variable or the 4-variable model. I usually choose the larger model if all p-values are under 0.10 because AIC and similar metrics are known to choose too few variables. Here however the Applic p-value in the 5-varable model is 0.124 and so I’d drop it, choosing the 4-variable model. What is also behind my decision to drop Applic is that it is a crude measure of amount of pesticide applied (county level data cut and pasted) and cbrtPctCorn essentially measures the same thing. Use your knowledge of the data to make your decision.</p>
<p><strong>Step 3b</strong> - Use the bestaic function to lower the AIC?</p>
<p>Starting with the full 8 variables, though PctCorn has been transformed to become cbrtPctCorn, run the bestaic function to see what models the computer selects:</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/bestaic.html">bestaic</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">recon.8onecube</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Evaluating 255 models and printing the 10 lowest AIC models </span>
<span class="co">#&gt;  n.xvars                                            model.xvars      aic</span>
<span class="co">#&gt;    5                 Applic Temp Dyplant Pctl Recon.cbrtPctCorn 797.8078</span>
<span class="co">#&gt;    4                        Temp Dyplant Pctl Recon.cbrtPctCorn 798.1920</span>
<span class="co">#&gt;    6            Area Applic Temp Dyplant Pctl Recon.cbrtPctCorn 798.5004</span>
<span class="co">#&gt;    5                   Area Temp Dyplant Pctl Recon.cbrtPctCorn 798.6990</span>
<span class="co">#&gt;    6          Applic SoilGp Temp Dyplant Pctl Recon.cbrtPctCorn 799.4286</span>
<span class="co">#&gt;    6          Applic Temp Precip Dyplant Pctl Recon.cbrtPctCorn 799.6515</span>
<span class="co">#&gt;    5                 SoilGp Temp Dyplant Pctl Recon.cbrtPctCorn 800.0487</span>
<span class="co">#&gt;    5                 Temp Precip Dyplant Pctl Recon.cbrtPctCorn 800.0798</span>
<span class="co">#&gt;    7     Area Applic SoilGp Temp Dyplant Pctl Recon.cbrtPctCorn 800.2693</span>
<span class="co">#&gt;    7     Area Applic Temp Precip Dyplant Pctl Recon.cbrtPctCorn 800.3545</span></code></pre></div>
<p>Many models are very similar in AIC, but the ‘best’ is the 5-variable model that we named <code>recon.5</code>, above. Second best was the four variable model we called <code>recon.4.</code> So by deleting sequentially we did get to the “best” models, but this is a lot quicker. As you see in the list there are several other models around an AIC of 798, and if it were less expensive to use the variables in one of these, it would be an excellent substitute for the mathematically lowest AIC model. For example the fourth model down uses Area instead of Applic, with all other variables the same. If <code>Applic</code> were expensive to collect, this model has an AIC only 0.9 units higher.</p>
<p><strong>Finding the best one-variable model.</strong> To find the best 1-variable model (just to compare to the ATS equation), run the four possible 1-variable models using the variables from the 4-variable model.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reg.recon.cbrtPctCorn</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/cencorreg.html">cencorreg</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">cbrtPctCorn</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-69-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;  Likelihood R = 0.1282                     AIC = 1214.138 
#&gt; Rescaled Likelihood R = 0.132            BIC = 1225.288 
#&gt;  McFaddens R = 0.07598 
#&gt; </code></pre>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reg.recon.Temp</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/cencorreg.html">cencorreg</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">Temp</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-70-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;  Likelihood R = 0.2952                     AIC = 1182.583 
#&gt; Rescaled Likelihood R = 0.3039            BIC = 1193.733 
#&gt;  McFaddens R = 0.1782 
#&gt; </code></pre>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reg.recon.Dyplant</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/cencorreg.html">cencorreg</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">Dyplant</span> <span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-71-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;  Likelihood R = -0.6899                     AIC = 947.8357 
#&gt; Rescaled Likelihood R = -0.7103            BIC = 958.9849 
#&gt;  McFaddens R = -0.4745 
#&gt; </code></pre>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reg.recon.Pctl</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/cencorreg.html">cencorreg</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">Pctl</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-72-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;  Likelihood R = 0.5878                     AIC = 1041.861 
#&gt; Rescaled Likelihood R = 0.6052            BIC = 1053.011 
#&gt;  McFaddens R = 0.3843 
#&gt; </code></pre>
<p>The Dyplant (days since planting) variable has the lowest AIC. Its residuals plot (above) shows a linear pattern pulled away from the normal theory line because of six high outliers. The negative slope is reasonable: as there are more days since planting of corn, and atrazine is only applied before planting, the more time it sits on the ground the lower the amounts available to be washed off into the stream. The outliers are probably high flows that would be accounted for by the Pctl variable if it were in the model. Here are the details for the Dyplant 1-variable model:</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">reg.recon.Dyplant</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; survreg(formula = "log(AtraConc)", data = "Dyplant", dist = "gaussian")</span>
<span class="co">#&gt;                Value Std. Error      z       p</span>
<span class="co">#&gt; (Intercept)  1.34758    0.22401   6.02 1.8e-09</span>
<span class="co">#&gt; Dyplant     -0.03063    0.00229 -13.40 &lt; 2e-16</span>
<span class="co">#&gt; Log(scale)   0.96971    0.06270  15.47 &lt; 2e-16</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Scale= 2.64 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gaussian distribution</span>
<span class="co">#&gt; Loglik(model)= -470.4   Loglik(intercept only)= -607.1</span>
<span class="co">#&gt;  Chisq= 273.31 on 1 degrees of freedom, p= 2.2e-61 </span>
<span class="co">#&gt; Number of Newton-Raphson Iterations: 6 </span>
<span class="co">#&gt; n= 423</span></code></pre></div>
<p><strong>The Nonparametric ATS line:</strong> Using Dyplant as the X variable,</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/ATS.html">ATS</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">Dyplant</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Akritas-Theil-Sen line for censored data </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; ln(AtraConc) = 3.3637 -0.0364 * Dyplant </span>
<span class="co">#&gt; Kendall's tau = -0.3995   p-value = 0 </span>
<span class="co">#&gt; </span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-74-1.png" width="624" style="display: block; margin: auto;"></p>
<p>Seeing this transformed back into the original units will look much better.</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/ATS.html">ATS</a></span><span class="op">(</span><span class="va">AtraConc</span>, <span class="va">AtraCen</span>, <span class="va">Dyplant</span>,retrans<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Akritas-Theil-Sen line for censored data </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; ln(AtraConc) = 3.3637 -0.0364 * Dyplant </span>
<span class="co">#&gt; Kendall's tau = -0.3995   p-value = 0 </span>
<span class="co">#&gt; </span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-75-1.png" width="624" style="display: block; margin: auto;"><img src="DataAnalysis_files/figure-html/unnamed-chunk-75-2.png" width="624" style="display: block; margin: auto;"></p>
<p>For this dataset, the maximum likelihood and ATS slopes for Dyplant are very similar (different by 0.006). The intercepts are similar as well when you realize that a difference of 2.0 is small when concentrations go up to 100.</p>
<p>The plot of the relationship of atrazine to flow percentile (Pctl) shows a clear washoff effect at higher flows:</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Recon</span>,<span class="fu"><a href="../reference/ATS.html">ATS</a></span><span class="op">(</span><span class="va">AtraConc</span>,<span class="va">AtraCen</span>, <span class="va">Pctl</span>,retrans<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Akritas-Theil-Sen line for censored data </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; ln(AtraConc) = -5.4878 + 0.0889 * Pctl </span>
<span class="co">#&gt; Kendall's tau = 0.3465   p-value = 0 </span>
<span class="co">#&gt; </span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-76-1.png" width="624" style="display: block; margin: auto;"><img src="DataAnalysis_files/figure-html/unnamed-chunk-76-2.png" width="624" style="display: block; margin: auto;"></p>
<p>There is not yet (June 2022) a good nonparametric “multiple regression” method for censored data. There are ‘robust regression’ methods that perform nonparametric regression but I’ve never seen them applied to censored data.</p>
</div>
<div id="trend-analysis-for-censored-data" class="section level2">
<h2 class="hasAnchor">
<a href="#trend-analysis-for-censored-data" class="anchor"></a>Trend Analysis for Censored Data</h2>
<p>Load the Gales_Creek dataset:</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Gales_Creek</span><span class="op">)</span></code></pre></div>
<div id="nonparametric-methods" class="section level3">
<h3 class="hasAnchor">
<a href="#nonparametric-methods" class="anchor"></a>Nonparametric Methods</h3>
<p><em>ATS (no covariate or seasonal variation)</em> We choose to use the original units (<code>LOG=FALSE</code>) because the data appear linear over time with one large outlier, and a nonparametric test will not be overly influenced by one outlier. Running the ATS function on concentration versus decimal time, we find strong evidence for a downtrend (p = 0.006):</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Gales_Creek</span>,<span class="fu"><a href="../reference/ATS.html">ATS</a></span><span class="op">(</span><span class="va">TCr</span>,<span class="va">CrND</span>,<span class="va">dectime</span>,LOG<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Akritas-Theil-Sen line for censored data </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; TCr = 181.2617 -0.0896 * dectime </span>
<span class="co">#&gt; Kendall's tau = -0.234   p-value = 0.00648 </span>
<span class="co">#&gt; </span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-78-1.png" width="624" style="display: block; margin: auto;"></p>
<p>It isn’t easy to see on the plot, but the detection limits shown as dashed lines are higher before 2012 as opposed to after 2012. The methods of this section of the course work well with multiple detection limits in the data record.</p>
<p><em>ATS on residuals from a smooth with a covariate</em> Using the centrend function, we first smooth the chromium – streamflow relationship, and then test the residuals for trend:</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Gales_Creek</span>,<span class="fu"><a href="../reference/centrend.html">centrend</a></span><span class="op">(</span><span class="va">TCr</span>,<span class="va">CrND</span>,<span class="va">discharge</span>,<span class="va">dectime</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-79-1.png" width="624" style="display: block; margin: auto;"><img src="DataAnalysis_files/figure-html/unnamed-chunk-79-2.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt; Trend analysis of TCr adjusted for discharge 
#&gt; Akritas-Theil-Sen line for censored data 
#&gt;  
#&gt; TCr residuals = 60.117 -0.0301 * dectime 
#&gt; Kendall's tau = -0.0579   p-value = 0.5051 
#&gt; </code></pre>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-79-3.png" width="624" style="display: block; margin: auto;"></p>
<p>There is no trend in chromium concentration once the effect of streamflow has been subtracted out. It appears that the evidence for a downtrend was due to a change in the flow regime over the time period. There is a strong relationship between flow and chromium concentrations.</p>
<p><em>Seasonal Kendall test</em> Perhaps there is a trend in either the dry season alone, ignoring the effects of high flows on the trend test? Perform the Seasonal Kendall test using the censeaken function and pay attention to the individual season results by plotting them using the <code>seaplots = TRUE</code> option.</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Gales_Creek</span>,<span class="fu"><a href="../reference/censeaken.html">censeaken</a></span><span class="op">(</span><span class="va">dectime</span>,<span class="va">TCr</span>,<span class="va">CrND</span>,<span class="va">Season</span>,seaplots<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  DATA ANALYZED: TCr vs dectime by Season </span>
<span class="co">#&gt; ----------</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-80-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;   Season  N    S    tau     pval Intercept    slope
#&gt; 1    Dry 34 -120 -0.214 0.069046    101.24 -0.05001
#&gt; ----------</code></pre>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-80-2.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;   Season  N   S    tau    pval Intercept   slope
#&gt; 1    Wet 29 -83 -0.204 0.12381    233.15 -0.1151
#&gt; ---------- 
#&gt; Seasonal Kendall test and Theil-Sen line</code></pre>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-80-3.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;   reps_R  N S_SK tau_SK   pval intercept    slope
#&gt; 1   4999 63 -203  -0.21 0.0122    181.26 -0.08965
#&gt; ----------</code></pre>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-80-4.png" width="624" style="display: block; margin: auto;"></p>
<p>There is an overall trend once the Seasonal Kendall test has removed all comparisons between values in different seasons. Also, the dry season has a p-value of 0.069. The prevailing wisdom in statistics in 2019 is to not get too rigid about an alpha of 0.05. A value of 0.069 is close to 0.05 and the trend in the dry season graph appears strong. I would report in this case that there is an overall downtrend and a downtrend in the dry season. The high flows in the wet season were preventing the non-seasonal <code>centrend</code> function from seeing the trend.</p>
<p><em>Seasonal Kendall test with a covariate</em> The centrendsea function will perform the seasonal Kendall test on the residuals from a GAM smooth of the original Y variable verses a covariate, like flow. This first computes the same covariate adjustment of the centrend function and using the residuals from the smooth, tests the “covariate-adjusted trend” using the Seasonal Kendall test. The variables to be entered are, in order, the Y variable to be tested for trend, the T/F indicator of censoring for the Y variable, the covariate, the time variable, and the season category variable.</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Gales_Creek</span>,<span class="fu"><a href="../reference/centrendsea.html">centrendsea</a></span><span class="op">(</span><span class="va">TCr</span>,<span class="va">CrND</span>,<span class="va">discharge</span>,<span class="va">dectime</span>,<span class="va">Season</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-81-1.png" width="624" style="display: block; margin: auto;"><img src="DataAnalysis_files/figure-html/unnamed-chunk-81-2.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt; 
#&gt;  Trend analysis by Season of: TCr adjusted for discharge 
#&gt; ----------</code></pre>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-81-3.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;   Season  N  S     tau    pval Intercept   slope
#&gt; 1    Dry 34 -8 -0.0143 0.91638     34.52 -0.0172
#&gt; ----------</code></pre>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-81-4.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;   Season  N   S    tau    pval Intercept    slope
#&gt; 1    Wet 29 -58 -0.143 0.28481    86.864 -0.04316
#&gt; ---------- 
#&gt; Seasonal Kendall test and Akritas-Theil-Sen line on residuals</code></pre>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-81-5.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;   reps_R  N S_SK  tau_SK   pval intercept    slope
#&gt; 1   4999 63  -66 -0.0683 0.4476    59.654 -0.02967
#&gt; ----------</code></pre>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-81-6.png" width="624" style="display: block; margin: auto;"></p>
<p>There is no trend in flow-adjusted chromium found for this site and dates. The slight decrease of the ATS line above, which includes the influence of the below detection limit observations as well as detected observations, is not significantly different from a zero slope.</p>
</div>
<div id="parametric-method" class="section level3">
<h3 class="hasAnchor">
<a href="#parametric-method" class="anchor"></a>Parametric Method</h3>
<p><em>Simple Censored Regression</em> Using the default log transformation of chromium because we know there is one large outlier lurking, the <code>cencorreg</code> function shows that the residuals are not a normal distribution, but the data appear quite straight except for the one high outlier. There is likely no better scale to work in – untransformed concentrations would be far worse. Without deleting the outlier (you should check it to see if there’s been an error, but you can’t because this isn’t your data!), do not delete the outlier without cause and work in the log units.</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Gales_Creek</span>,<span class="fu"><a href="../reference/cencorreg.html">cencorreg</a></span><span class="op">(</span><span class="va">TCr</span>,<span class="va">CrND</span>,<span class="va">dectime</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-82-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;  Likelihood R = -0.2665                     AIC = 163.4814 
#&gt; Rescaled Likelihood R = -0.2775            BIC = 168.9581 
#&gt;  McFaddens R = -0.1697 
#&gt; 
#&gt; Call:
#&gt; survreg(formula = "log(TCr)", data = "dectime", dist = "gaussian")
#&gt; 
#&gt; Coefficients:
#&gt;  (Intercept)      dectime 
#&gt; 192.32546251  -0.09565766 
#&gt; 
#&gt; Scale= 0.9595278 
#&gt; 
#&gt; Loglik(model)= -78.2   Loglik(intercept only)= -80.6
#&gt;  Chisq= 4.64 on 1 degrees of freedom, p= 0.0312 
#&gt; n= 63</code></pre>
<p>The regression p-value of 0.03 says that there is a trend. The slope of – 0.095 log units per year will be approximately a 10% decrease in chromium per year. But is this slope a good estimate, given that there appear to be a confounding effect of streamflow? So perform a censored multiple regression.</p>
<p><em>Censored Multiple Regression</em> Create a data frame of the two X variables, dectime and flow, and try again. This is a better model if flow explains a lot of the variation in concentration. If that’s the case the model’s AIC will be lower than the previous AIC of 163.48.</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">timeflow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Gales_Creek</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">dectime</span>, <span class="va">discharge</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Gales_Creek</span>,<span class="fu"><a href="../reference/cencorreg.html">cencorreg</a></span><span class="op">(</span><span class="va">TCr</span>,<span class="va">CrND</span>,<span class="va">timeflow</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-83-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;  Likelihood R2 = 0.5926                     AIC = 113.5493 
#&gt;  Rescaled Likelihood R2 = 0.6424            BIC = 121.1848 
#&gt;  McFaddens R2 = 0.351119 
#&gt; 
#&gt; Call:
#&gt; survreg(formula = "log(TCr)", data = "dectime+discharge", dist = "gaussian")
#&gt; 
#&gt; Coefficients:
#&gt;   (Intercept)       dectime     discharge 
#&gt; 220.206866401  -0.109654346   0.001290593 
#&gt; 
#&gt; Scale= 0.5499025 
#&gt; 
#&gt; Loglik(model)= -52.3   Loglik(intercept only)= -80.6
#&gt;  Chisq= 56.57 on 2 degrees of freedom, p= 5.19e-13 
#&gt; n= 63</code></pre>
<p>The QQ plot looks great, and the residuals do not differ from a normal distribution. The AIC is considerably lower for the 2-variable model, so this model that accounts for flow variation should be used instead of the original model.</p>
<p><em>Censored Multiple Regression with Seasonal Variables</em> Sounds like a menu option (‘seasonal vegetables’), doesn’t it? Create the sin and cos function variables using <code>2*pi*dectime</code>, and add it to the stew. See if they add anything.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sinT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Gales_Creek</span>, <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">dectime</span><span class="op">)</span><span class="op">)</span>
<span class="va">cosT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Gales_Creek</span>, <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">dectime</span><span class="op">)</span><span class="op">)</span>
<span class="va">timeflowseas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Gales_Creek</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">dectime</span>, <span class="va">discharge</span><span class="op">)</span><span class="op">)</span>
<span class="va">timeflowseas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">timeflowseas</span>,<span class="va">sinT</span>,<span class="va">cosT</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Gales_Creek</span>, <span class="fu"><a href="../reference/cencorreg.html">cencorreg</a></span><span class="op">(</span><span class="va">TCr</span>, <span class="va">CrND</span>, <span class="va">timeflowseas</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-84-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;  Likelihood R2 = 0.659                     AIC = 106.3479 
#&gt;  Rescaled Likelihood R2 = 0.7143            BIC = 118.3012 
#&gt;  McFaddens R2 = 0.4206397 
#&gt; 
#&gt; Call:
#&gt; survreg(formula = "log(TCr)", data = "dectime+discharge+sinT+cosT", 
#&gt;     dist = "gaussian")
#&gt; 
#&gt; Coefficients:
#&gt;  (Intercept)      dectime    discharge         sinT         cosT 
#&gt; 196.27125199  -0.09773029   0.00104809   0.21495631   0.30433249 
#&gt; 
#&gt; Scale= 0.5097264 
#&gt; 
#&gt; Loglik(model)= -46.7   Loglik(intercept only)= -80.6
#&gt;  Chisq= 67.77 on 4 degrees of freedom, p= 6.69e-14 
#&gt; n= 63</code></pre>
<p>The QQ plot looks good. The sin and cos model has a lower AIC (106.3 versus the 2-variable model’s 113.5) so this is the best model of the three. The slope of -0.098 per year still maps to around a 10% decrease in concentration per year.</p>
</div>
</div>
<div id="logistic-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#logistic-regression" class="anchor"></a>Logistic Regression</h2>
<p>The ReconLogistic dataset presents atrazine concentrations at streams across the midwestern United States. There were multiple detection limits, and a health advisory of 1 ug/L. Several characteristics of the basin at the time of sampling, including streamflow, are also recorded.</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">ReconLogistic</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ReconLogistic</span>,<span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;   CORNpct SOILGP PRECIP DYPLANT FPCTL APPLIC TEMP GT_1</span>
<span class="co">#&gt; 1      15    2.9   94.5      10    97   19.0 10.2    1</span>
<span class="co">#&gt; 2      15    2.9   94.5     130    19   19.0 10.2    0</span>
<span class="co">#&gt; 3      19    2.9   94.0     284    86   25.4 10.8    0</span></code></pre></div>
<p>We will model the above/below 1 ug/L pattern using the <code>GT_1</code> variable. The primary assumption is that there is a linear relationship between the X variables and the log(odds). Start by checking VIFs for all 6 candidate variables. The <code>glm</code> command using the <code>family=binomial(logit)</code> link function produces the equation:</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glm.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">GT_1</span><span class="op">~</span>
               <span class="va">APPLIC</span><span class="op">+</span>
               <span class="va">CORNpct</span><span class="op">+</span>
               <span class="va">SOILGP</span><span class="op">+</span>
               <span class="va">PRECIP</span><span class="op">+</span>
               <span class="va">DYPLANT</span><span class="op">+</span>
               <span class="va">FPCTL</span>,
             <span class="va">ReconLogistic</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="va">logit</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/rms/man/vif.html">vif</a></span><span class="op">(</span><span class="va">glm.1</span><span class="op">)</span>
<span class="co">#&gt;   APPLIC  CORNpct   SOILGP   PRECIP  DYPLANT    FPCTL </span>
<span class="co">#&gt; 1.802862 1.738165 1.467392 1.550877 1.172150 1.119903</span></code></pre></div>
<p>There is no multicollinearity between the variables, as indicated by VIF values of less than 2. Therefore the reported p-values should be trustworthy.</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">glm.1</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = GT_1 ~ APPLIC + CORNpct + SOILGP + PRECIP + DYPLANT + </span>
<span class="co">#&gt;     FPCTL, family = binomial(logit), data = ReconLogistic)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -2.1267  -0.4117  -0.1715   0.3839   3.4336  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept) -6.323566   1.693157  -3.735 0.000188 ***</span>
<span class="co">#&gt; APPLIC       0.017530   0.020220   0.867 0.385984    </span>
<span class="co">#&gt; CORNpct      0.034572   0.023263   1.486 0.137250    </span>
<span class="co">#&gt; SOILGP       0.439216   0.503541   0.872 0.383070    </span>
<span class="co">#&gt; PRECIP       0.039064   0.015949   2.449 0.014315 *  </span>
<span class="co">#&gt; DYPLANT     -0.016791   0.001919  -8.749  &lt; 2e-16 ***</span>
<span class="co">#&gt; FPCTL        0.036820   0.006130   6.006  1.9e-09 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 558.0  on 422  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 245.9  on 416  degrees of freedom</span>
<span class="co">#&gt; AIC: 259.9</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></code></pre></div>
<p>To compute the overall test of whether this model is better than no model at all, the test that all slopes are zero, first compute the null model by using a 1 instead of any X variables in the right-hand side of the equation:</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glm.null</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">GT_1</span><span class="op">~</span><span class="fl">1</span>,<span class="va">ReconLogistic</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="va">logit</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">glm.null</span>,<span class="va">glm.1</span>,test<span class="op">=</span><span class="st">"Chisq"</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model 1: GT_1 ~ 1</span>
<span class="co">#&gt; Model 2: GT_1 ~ APPLIC + CORNpct + SOILGP + PRECIP + DYPLANT + FPCTL</span>
<span class="co">#&gt;   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    </span>
<span class="co">#&gt; 1       422      558.0                          </span>
<span class="co">#&gt; 2       416      245.9  6    312.1 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>The test statistic often named G equals 312.1. Compared to a chi-squared distribution with 6 degrees of freedom, the difference in the number of X variables between the two models, this statistic has a p-value of 2 x 10^-16, and so is very significant. We conclude that there is information in this model for predicting atrazine occurrence above 1 and proceed to try and find the best model. The simplest way to have the computer tell you the best logistic regression model is to use the bestglm command. But let’s try manually first and see how we do. We need to see if any of the X variables need to be transformed.</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/car/man/residualPlots.html">residualPlots</a></span><span class="op">(</span><span class="va">glm.1</span>,type<span class="op">=</span><span class="st">"deviance"</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-89-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>#&gt;         Test stat Pr(&gt;|Test stat|)    
#&gt; APPLIC     2.2736        0.1315939    
#&gt; CORNpct    0.9137        0.3391386    
#&gt; SOILGP     8.8183        0.0029822 ** 
#&gt; PRECIP     4.2759        0.0386572 *  
#&gt; DYPLANT   12.0510        0.0005177 ***
#&gt; FPCTL      3.4084        0.0648658 .  
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>It is hard to judge residuals plots with logistic regression because there are separate groups of residuals for the Y = 0 and 1 data. The smooth for DYPLANT appears curved, but is not an improvement. If <code><a href="https://rdrr.io/r/base/Log.html">log(Dyplant)</a></code> is substituted for <code>Dyplant</code> the AIC increases, so is not a better model.</p>
<p>Using <code>glm.1</code>, <code>Applic</code> had the highest p-value, so we’ll drop it and see if AIC goes below 259.9.</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glm.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">GT_1</span><span class="op">~</span>
               <span class="va">CORNpct</span><span class="op">+</span>
               <span class="va">SOILGP</span><span class="op">+</span>
               <span class="va">PRECIP</span><span class="op">+</span>
               <span class="va">DYPLANT</span><span class="op">+</span>
               <span class="va">FPCTL</span>,
             <span class="va">ReconLogistic</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="va">logit</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">glm.3</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = GT_1 ~ CORNpct + SOILGP + PRECIP + DYPLANT + FPCTL, </span>
<span class="co">#&gt;     family = binomial(logit), data = ReconLogistic)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -2.2041  -0.4140  -0.1716   0.3764   3.4801  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept) -6.818507   1.599850  -4.262 2.03e-05 ***</span>
<span class="co">#&gt; CORNpct      0.045965   0.019277   2.384  0.01711 *  </span>
<span class="co">#&gt; SOILGP       0.509550   0.495964   1.027  0.30424    </span>
<span class="co">#&gt; PRECIP       0.043378   0.015074   2.878  0.00401 ** </span>
<span class="co">#&gt; DYPLANT     -0.016598   0.001876  -8.848  &lt; 2e-16 ***</span>
<span class="co">#&gt; FPCTL        0.037835   0.005993   6.313 2.73e-10 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 558.00  on 422  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 246.66  on 417  degrees of freedom</span>
<span class="co">#&gt; AIC: 258.66</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></code></pre></div>
<p>This 5-variable model is improved over <code>glm.1</code>. <code>SoilGp</code> remains insignificant so let’s drop that and see the effect on AIC.</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glm.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">GT_1</span><span class="op">~</span>
               <span class="va">CORNpct</span><span class="op">+</span>
               <span class="va">PRECIP</span><span class="op">+</span>
               <span class="va">DYPLANT</span><span class="op">+</span>
               <span class="va">FPCTL</span>,
             <span class="va">ReconLogistic</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="va">logit</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">glm.4</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = GT_1 ~ CORNpct + PRECIP + DYPLANT + FPCTL, family = binomial(logit), </span>
<span class="co">#&gt;     data = ReconLogistic)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -2.1097  -0.4123  -0.1875   0.3781   3.3046  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept) -5.856860   1.267119  -4.622 3.80e-06 ***</span>
<span class="co">#&gt; CORNpct      0.039045   0.017943   2.176 0.029554 *  </span>
<span class="co">#&gt; PRECIP       0.050493   0.013412   3.765 0.000167 ***</span>
<span class="co">#&gt; DYPLANT     -0.016507   0.001866  -8.846  &lt; 2e-16 ***</span>
<span class="co">#&gt; FPCTL        0.037770   0.005970   6.327 2.51e-10 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 558.00  on 422  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 247.72  on 418  degrees of freedom</span>
<span class="co">#&gt; AIC: 257.72</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></code></pre></div>
<p>AIC is lower (improved). All terms are significant. We’ll settle on this as our final model. This is the model found ‘best’ using <code>bestglm</code> (note that <code>bestglm</code> requires the <code>data.frame</code> to have the 0/1 Y variable in the last column, which <code>Recon</code> does).</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/bestglm/man/bestglm.html">bestglm</a></span><span class="op">(</span><span class="va">ReconLogistic</span>,family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="va">logit</span><span class="op">)</span>, IC <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span>
<span class="co">#&gt; Morgan-Tatar search since family is non-gaussian.</span>
<span class="co">#&gt; AIC</span>
<span class="co">#&gt; BICq equivalent for q in (0.388676345462891, 0.914863500091258)</span>
<span class="co">#&gt; Best Model:</span>
<span class="co">#&gt;                Estimate  Std. Error   z value     Pr(&gt;|z|)</span>
<span class="co">#&gt; (Intercept) -6.53329819 1.181212560 -5.531010 3.183926e-08</span>
<span class="co">#&gt; CORNpct      0.04814197 0.018616040  2.586048 9.708340e-03</span>
<span class="co">#&gt; DYPLANT     -0.01743824 0.002029210 -8.593611 8.427813e-18</span>
<span class="co">#&gt; FPCTL        0.03585721 0.006189977  5.792787 6.922797e-09</span>
<span class="co">#&gt; TEMP         0.50653496 0.102252080  4.953786 7.278310e-07</span></code></pre></div>
<p>glm.4 has slopes with algebraic signs that make scientific sense, and all explanatory variables are significant at alpha = 0.05. The model can be compared to the original 6 variable model using either a partial test, or with the AIC. The partial test determines whether the two variables that were dropped add significantly to the explanatory power of the model, just as in multiple linear regression. The null hypothesis is that they do not; not rejecting the null hypothesis says to keep the simpler model.</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">glm.4</span>, <span class="va">glm.1</span>, test<span class="op">=</span><span class="st">"Chisq"</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model 1: GT_1 ~ CORNpct + PRECIP + DYPLANT + FPCTL</span>
<span class="co">#&gt; Model 2: GT_1 ~ APPLIC + CORNpct + SOILGP + PRECIP + DYPLANT + FPCTL</span>
<span class="co">#&gt;   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)</span>
<span class="co">#&gt; 1       418     247.72                     </span>
<span class="co">#&gt; 2       416     245.90  2   1.8257   0.4014</span></code></pre></div>
<p>We do not reject that the smaller model is just as good. Go with <code>glm.4</code>. Finally, if we want to get an r-squared or a Brier score, and get some plots of the relation between the log-odds and each X variable, compute the same 4-variable model using the <code>lrm</code> command from the <code>rms</code> package:</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Recon.frame</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">ReconLogistic</span>, <span class="fu"><a href="https://rdrr.io/pkg/rms/man/datadist.html">datadist</a></span><span class="op">(</span><span class="va">CORNpct</span>, <span class="va">DYPLANT</span>, <span class="va">FPCTL</span>, <span class="va">TEMP</span>, <span class="va">GT_1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>datadist <span class="op">=</span> <span class="st">"Recon.frame"</span><span class="op">)</span>
<span class="va">lrm4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/lrm.html">lrm</a></span><span class="op">(</span><span class="va">GT_1</span> <span class="op">~</span> <span class="va">CORNpct</span> <span class="op">+</span> <span class="va">DYPLANT</span> <span class="op">+</span> <span class="va">FPCTL</span> <span class="op">+</span> <span class="va">TEMP</span>, data <span class="op">=</span> <span class="va">ReconLogistic</span><span class="op">)</span>
<span class="va">lrm4</span>
<span class="co">#&gt; Logistic Regression Model</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  lrm(formula = GT_1 ~ CORNpct + DYPLANT + FPCTL + TEMP, data = ReconLogistic)</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;                         Model Likelihood    Discrimination    Rank Discrim.    </span>
<span class="co">#&gt;                               Ratio Test           Indexes          Indexes    </span>
<span class="co">#&gt;  Obs           423    LR chi2     323.35    R2       0.729    C       0.939    </span>
<span class="co">#&gt;   0            266    d.f.             4    g        3.298    Dxy     0.877    </span>
<span class="co">#&gt;   1            157    Pr(&gt; chi2) &lt;0.0001    gr      27.049    gamma   0.877    </span>
<span class="co">#&gt;  max |deriv| 8e-07                          gp       0.418    tau-a   0.410    </span>
<span class="co">#&gt;                                             Brier    0.076                     </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;            Coef    S.E.   Wald Z Pr(&gt;|Z|)</span>
<span class="co">#&gt;  Intercept -6.5333 1.1812 -5.53  &lt;0.0001 </span>
<span class="co">#&gt;  CORNpct    0.0481 0.0186  2.59  0.0097  </span>
<span class="co">#&gt;  DYPLANT   -0.0174 0.0020 -8.59  &lt;0.0001 </span>
<span class="co">#&gt;  FPCTL      0.0359 0.0062  5.79  &lt;0.0001 </span>
<span class="co">#&gt;  TEMP       0.5065 0.1023  4.95  &lt;0.0001 </span>
<span class="co">#&gt; </span></code></pre></div>
</div>
<div id="multivariate-methods-for-censored-data" class="section level2">
<h2 class="hasAnchor">
<a href="#multivariate-methods-for-censored-data" class="anchor"></a>Multivariate Methods for Censored Data</h2>
<p>Symonds et al (2016) used microbial source tracking (MST) markers to detect fecal pollution in waters along the coast of Florida. Six MST markers are in the dataset <code>Markers</code> in interval-censored format, where (0 to MDL) indicate values below a limit of detection. Nonzero lower ends of the interval indicate either (MDL to QL) data or detected values above the QL. Also included is the US EPA total enterococci marker <code>Entero1A</code>, a general fecal pollution indicator.</p>
<ol style="list-style-type: decimal">
<li><p>Test whether the pattern of the six MST markers plus the <code>Entero1A</code> indicator differs among the five sites using <code>ANOSIM</code>.</p></li>
<li><p>Test whether there is a ‘trend’ (correlation) between the six MST markers versus the general fecal pollution indicator using the Mantel test for trend analysis using Kendall’s tau correlation between the matrices (multivariate nonparametric correlation).</p></li>
</ol>
<hr>
<p><em>Solution</em></p>
<ol style="list-style-type: decimal">
<li>Load the data and compute the ranks of the uscores; then compute the anosim test for group differences and illustrate the results with an MDS:</li>
</ol>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Markers</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Markers</span>,<span class="fl">3</span><span class="op">)</span>

<span class="va">Mdat</span> <span class="op">&lt;-</span> <span class="va">Markers</span><span class="op">[</span>, <span class="op">-</span><span class="fl">15</span><span class="op">]</span> <span class="co"># remove the Site Name column</span>

<span class="va">M.usc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/uscoresi.html">uscoresi</a></span><span class="op">(</span><span class="va">Mdat</span><span class="op">)</span>    <span class="co"># uscoresi drops rows with NAs  (row 13 here)</span>
<span class="va">M.euclid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">M.usc</span><span class="op">)</span>
<span class="va">Site</span> <span class="op">&lt;-</span> <span class="va">Markers</span><span class="op">$</span><span class="va">Site_Name</span><span class="op">[</span><span class="op">-</span><span class="fl">13</span><span class="op">]</span>  <span class="co"># delete the site entry for row 13 with NAs</span>
<span class="va">M.anosim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/anosim.html">anosim</a></span><span class="op">(</span><span class="va">M.euclid</span>, <span class="va">Site</span><span class="op">)</span>
<span class="va">M.anosim</span>


<span class="fu"><a href="../reference/anosimPlot.html">anosimPlot</a></span><span class="op">(</span><span class="va">M.anosim</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-95-1.png" width="624" style="display: block; margin: auto;"></p>
<p>There is a difference between the five sites. To illustrate which sites appear different than others, draw an NMDS plot:</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/uMDS.html">uMDS</a></span><span class="op">(</span><span class="va">M.usc</span>, group <span class="op">=</span> <span class="va">Site</span>, 
     legend.pos <span class="op">=</span> <span class="st">"topright"</span>, 
     title <span class="op">=</span> <span class="st">"NMDS of rank(uscores) for markers + entero"</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-96-1.png" width="624" style="display: block; margin: auto;"></p>
<p>From the left-right axis (NMDS1) we see that all three inlets (Port of Miami, Port Everglades and Baker’s Haulover) are on the left side, while Miami Central, an ocean outfall site, is on the right side. That is the main contrast between sites. From the second axis (NMDS2) there are one or two samples within Sites that are ‘outliers’ towards the top as compared to others in that site. Some characteristic differs in those samples. Sample 11 compared to the rest of Miami_North and site 14 compared to the rest of Baker’s Haulover, for example. Second axes for NMDS aren’t always interpretable, but the first axis should be expected to show the main difference detected by the ANOSIM result.</p>
<p>If you’d like to draw the NMDS plot manually, perhaps to change some options from what is in the function, here is the R code that will draw the same plot as the <code>uMDS</code> function:</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">M.nmds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/metaMDS.html">metaMDS</a></span><span class="op">(</span><span class="va">M.euclid</span><span class="op">)</span>
<span class="va">Site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Site</span><span class="op">)</span>
<span class="va">gp.color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">Site</span><span class="op">)</span>
<span class="va">Mplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/ordiplot.html">ordiplot</a></span><span class="op">(</span><span class="va">M.nmds</span>, type<span class="op">=</span><span class="st">"none"</span>, display <span class="op">=</span> <span class="st">"sites"</span>, 
                  main<span class="op">=</span><span class="st">"NMDS of rank(uscores) for markers + entero"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">Mplot</span>, <span class="st">"sites"</span>, pch<span class="op">=</span><span class="fl">19</span>, col<span class="op">=</span><span class="va">gp.color</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">Mplot</span>, <span class="st">"sites"</span>, pos<span class="op">=</span><span class="fl">4</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>
<span class="va">leg.col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">Site</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">Site</span><span class="op">)</span>, bty<span class="op">=</span><span class="st">"n"</span>, col <span class="op">=</span> <span class="va">leg.col</span>, text.col <span class="op">=</span> <span class="va">leg.col</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-97-1.png" width="624" style="display: block; margin: auto;"></p>
<ol start="2" style="list-style-type: decimal">
<li>Create two triangular distance matrices, one for the 6 MST markers and the second for the general fecal pollution indicator (entero1A) data. Then correlate the two matrices using the Mantel command. This is to see if there is a ‘trend’ in the MST marker pattern with increasing entero1A.</li>
</ol>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Mdata</span> <span class="op">&lt;-</span> <span class="va">Markers</span><span class="op">[</span><span class="op">-</span><span class="fl">13</span>,<span class="op">]</span>  <span class="co"># delete row with NAs</span>
<span class="va">M6</span> <span class="op">&lt;-</span> <span class="va">Mdata</span><span class="op">[</span>, <span class="op">-</span><span class="op">(</span><span class="fl">13</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span><span class="op">]</span>  <span class="co"># only keep columns for the 6 markers</span>
<span class="va">M6.usc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/uscoresi.html">uscoresi</a></span><span class="op">(</span><span class="va">M6</span><span class="op">)</span>
<span class="va">M6.euclid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">M6.usc</span><span class="op">)</span>  <span class="co"># matrix for the 6 MST markers</span>
<span class="va">ent</span> <span class="op">&lt;-</span> <span class="va">Mdata</span><span class="op">[</span>, <span class="fl">13</span><span class="op">:</span><span class="fl">14</span><span class="op">]</span>   <span class="co"># the entero1A data</span>
<span class="va">ent.usc</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/uscoresi.html">uscoresi</a></span><span class="op">(</span><span class="va">ent</span><span class="op">)</span>
<span class="co">#&gt; [1] 29</span>
<span class="va">ent.euclid</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">ent.usc</span><span class="op">)</span>  <span class="co"># matrix for the entero1A data</span>
<span class="va">M6.Ktau</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/mantel.html">mantel</a></span><span class="op">(</span><span class="va">ent.euclid</span>, <span class="va">M6.euclid</span>, method<span class="op">=</span><span class="st">"kendall"</span>, permutations <span class="op">=</span> <span class="fl">9999</span><span class="op">)</span> 
<span class="va">M6.Ktau</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Mantel statistic based on Kendall's rank correlation tau </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; mantel(xdis = ent.euclid, ydis = M6.euclid, method = "kendall",      permutations = 9999) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Mantel statistic r: 0.3627 </span>
<span class="co">#&gt;       Significance: 1e-04 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Upper quantiles of permutations (null model):</span>
<span class="co">#&gt;    90%    95%  97.5%    99% </span>
<span class="co">#&gt; 0.0459 0.0673 0.0885 0.1145 </span>
<span class="co">#&gt; Permutation: free</span>
<span class="co">#&gt; Number of permutations: 9999</span></code></pre></div>
<p>There is a significant positive correlation between the MST marker values and the entero1A values. One way to picture the correlation is to plot their distance matrix entries against one another. The x,y pairs are those in the triangular matrices that are being correlated using Kendall’s tau in the mantel test. If there was a positive correlation, for example, larger distances (relating small to large entero1A data) would also have larger M6 distances between MST marker concentrations. This is the pattern seen in the plot.</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Site</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Markers</span><span class="op">$</span><span class="va">Site_Name</span><span class="op">)</span>
<span class="va">gp.color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">Site</span><span class="op">)</span>  <span class="co"># assigns numbers to group names in Site_Name</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ent.euclid</span>, <span class="va">M6.euclid</span>, pch <span class="op">=</span> <span class="fl">19</span>, 
     col <span class="op">=</span> <span class="va">gp.color</span>, 
     main <span class="op">=</span> <span class="st">"Correlation of distance matrix of rank(uscores)"</span><span class="op">)</span>
<span class="va">lws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lowess.html">lowess</a></span><span class="op">(</span><span class="va">ent.euclid</span>, <span class="va">M6.euclid</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">lws</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">Site</span><span class="op">)</span>, bty<span class="op">=</span><span class="st">"n"</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nlevels.html">nlevels</a></span><span class="op">(</span><span class="va">Site</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-99-1.png" width="624" style="display: block; margin: auto;"></p>
<p>The plot, in addition to being colorful, shows the general increase of M6 distances as a function of entero1A distances, as shown by the lowess smooth. As entero1A values increase, the pattern of 6 marker concentrations also increases.</p>
<p><em>Extra Credit:</em> Which MST marker(s) have the highest correlation with the Entero1A values? This can be determined with the bioenv command in the vegan package. This command performs iterative mantel tests with subsets of the marker data. The highest correlation coefficient is the set of best predictors, which may be 1 up to all 6 of the markers.</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/bioenv.html">bioenv</a></span><span class="op">(</span><span class="va">ent.euclid</span>, <span class="va">M6.usc</span>, method <span class="op">=</span> <span class="st">"kendall"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; bioenv(comm = ent.euclid, env = M6.usc, method = "kendall") </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Subset of environmental variables with best correlation to community data.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Correlations:    kendall </span>
<span class="co">#&gt; Dissimilarities: euclidean </span>
<span class="co">#&gt; Metric:          euclidean </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Best model has 1 parameters (max. 6 allowed):</span>
<span class="co">#&gt; usc.HF183_lo</span>
<span class="co">#&gt; with correlation  0.4591559</span></code></pre></div>
<p>The highest correlation model is with one marker, HF183. This can be illustrated by plotting the entero1A uscores against the HF183 uscores. HF183 was the 4th of six columns within M6.</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ent.usc</span>, <span class="va">M6.usc</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-101-1.png" width="624" style="display: block; margin: auto;"></p>
<p>You can plot ent.usc against the other five MST markers if you wish to see which markers appear to be related to the Entero1A concentrations. My look at the plots – BacHum is also correlated, and HPyV has a binary style correlation – as Entero1A increases the probability of a high rather than low PHyV increases – rather than a linear relationship. This is because HPyV values occur in just two categories, (0 to 249) and (250 to 499). Had all data been censored to &lt;500 this relationship would not have been visible. See the plot below. HpyV was the 5th of the 6 marker columns. The other three markers (all animal MST markers) show little correlation with Entero1A.</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ent.usc</span>, <span class="va">M6.usc</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span>, ylab <span class="op">=</span> <span class="st">"HPyv rank of uscores"</span><span class="op">)</span></code></pre></div>
<p><img src="DataAnalysis_files/figure-html/unnamed-chunk-102-1.png" width="624" style="display: block; margin: auto;"></p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<ul>
<li><p>Helsel, D.R., 2012. Statistics for censored environmental data using Minitab and R, 2nd edition. John Wiley and Sons, New York. 344 p.</p></li>
<li><p>Millard, S.P., 2013. EnvStats: An R Package for Environmental Statistics (2nd Edition). Springer, New York.</p></li>
<li><p>Singh, A., Maichle, R. and S. Lee, 2006. On the Computation of a 95% Upper Confidence Limit of the Unknown Population Mean Based Upon Data Sets with Below Detection Limit Observations. Office of Research and Development, USEPA. EPA/600/R-06/022. 123 p.</p></li>
<li><p>Symonds et al., 2016. Faecal pollution along the southeastern coast of Florida and insight into the use of pepper mild mottle virus as an indicator, Journ Applied Microbio 121, p. 1469-1481.</p></li>
<li><p>Thode, H.C., 2002. Testing for Normality. Marcel Dekker, New York. 479 p.</p></li>
</ul>
</div>
<div id="appendix" class="section level2">
<h2 class="hasAnchor">
<a href="#appendix" class="anchor"></a>Appendix</h2>
<div id="a-flowchart-for-computation-of-ucl-epc-for-data-with-nondetects" class="section level3">
<h3 class="hasAnchor">
<a href="#a-flowchart-for-computation-of-ucl-epc-for-data-with-nondetects" class="anchor"></a>A “Flowchart” for Computation of UCL / EPC for Data with Nondetects</h3>
<p>The following steps can guide your choice of a method to compare a UCL to a legal standard or health advisory. Methods depend on the number of observations (detects and nondetects) available.</p>
<ol style="list-style-type: decimal">
<li><p>Are there at least 20 observations? NO: Assume the best fitting distribution to estimate the UCL. Go to step 2. YES: Use a bootstrap (nonparametric estimation) method. Go to step 3.</p></li>
<li><p>Distributional Methods</p></li>
</ol>
<ol style="list-style-type: lower-alpha">
<li><p>Use a boxplot (the cboxplot command) to take a first look at the data. Decide whether or not outliers are retained or not based on the sampling strategy that was used and the objectives of the study. If data were collected using a probabilistic sample, an equal-area sample, or other representative sampling, keep all observations unless the portions of the area the outliers represent are to be excluded from the estimation study. If it is unclear what area each observation represents, investigate why the outliers occur and decide accordingly. Note that outliers will strongly affect the estimate of the UCL95, so this decision is critical. If they are part of what people have been exposed to, keep them. If they are mistakes or represent an area that is not to be considered, delete them. A statistical test cannot be used to make this decision for you.</p></li>
<li>
<p>Decide which of three distributions best fits the data using either the cenCompareQQ or cenCompareCdfs function. Of these three, select the distribution with either the highest PPCC or lowest BIC statistic. I prefer the BIC statistic because it better measures the misfit caused by the normal distribution going negative and not matching the 0 lower limit of the data.</p>
<ul>
<li>If the normal distribution was selected, check the low (left) end of the plot to see when the projected values drop below zero, indicating negative concentrations are being estimated. If this percentage is more than a trace, the normal distribution is not a good fit, even if the PPCC was high. You should choose the next-highest PPCC distribution instead, or the lowest BIC statistic, instead of the normal distribution.</li>
</ul>
</li>
<li><p>Use the best-fit distribution from 2b to compute the UCL. The three commands, one for each of the three distributions, are:</p></li>
</ol>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/enormCensored.html">enormCensored</a></span><span class="op">(</span><span class="va">Data</span>, <span class="va">Cen</span>,ci<span class="op">=</span><span class="cn">TRUE</span>, ci.type<span class="op">=</span><span class="st">"upper"</span>, ci.method<span class="op">=</span><span class="st">"normal.approx"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/elnormAltCensored.html">elnormAltCensored</a></span><span class="op">(</span><span class="va">Data</span>, <span class="va">Cen</span>, ci<span class="op">=</span><span class="cn">TRUE</span>, ci.type<span class="op">=</span><span class="st">"upper"</span>, ci.method<span class="op">=</span><span class="st">"bootstrap"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/egammaAltCensored.html">egammaAltCensored</a></span><span class="op">(</span><span class="va">Data</span>, <span class="va">Cen</span>, ci<span class="op">=</span><span class="cn">TRUE</span>, ci.type<span class="op">=</span><span class="st">"upper"</span>, ci.method<span class="op">=</span><span class="st">"bootstrap"</span><span class="op">)</span></code></pre></div>
<p>In each of these commands, the input column of concentrations plus detection limits is shown as “Data”, and the censoring indicator column (0/1 or FALSE/TRUE) as “Cen”. Use the appropriate variable names in your dataset instead.</p>
<ol start="3" style="list-style-type: decimal">
<li>Nonparametric Methods</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>If there are multiple detection limits, use the Kaplan-Meier (KM) estimate, computing a UCL95 with a BCA or percentile bootstrap estimate. Report the BCA UCL95 estimate for up to 40% NDs and the percentile bootstrap for greater than 40% censoring (Singh et al., 2006, page 114). Use 5000 bootstrap repetitions so that the estimate is stable from one time to the next.</li>
</ol>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/enparCensored.html">enparCensored</a></span><span class="op">(</span><span class="va">Data</span>, <span class="va">Cen</span>, ci<span class="op">=</span><span class="cn">TRUE</span>, ci.method<span class="op">=</span><span class="st">"bootstrap"</span>, ci.type<span class="op">=</span><span class="st">"upper"</span>, n.bootstraps<span class="op">=</span><span class="fl">5000</span><span class="op">)</span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>
<p>If there is only one detection limit the KM method in essence substitutes the detection limit for all NDs. It will not project values below the lowest DL as that would require a distribution to show how the values are arranged below the lowest DL. This will bias upward the estimate of the mean. I recommend you bootstrap the lognormal ROS method (elnormAltCensored command) instead.</p>
<p>Singh et al. (2006) state that the UCL95 is better estimated using KM than by ROS methods for censored data, and based on this overall statement, recommend that KM be used in any situation with nondetects. I believe they haven’t split out the one-DL situations separately and looked at the resulting bias. They simply state that they’ve shown that KM is always better. Statisticians disagree.</p>
</li>
</ol>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Paul Julian, Dennis Helsel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
